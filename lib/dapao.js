!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o=e();for(var i in o)("object"==typeof exports?exports:t)[i]=o[i]}}(this,function(){return function(t){var e={};function o(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);var i=function(){function t(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}return t.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},t.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},t.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},t.prototype.getTrace=function(t){t=t||new n;var e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},t.prototype.vmult=function(t,e){e=e||new n;var o=this.elements,i=t.x,r=t.y,s=t.z;return e.x=o[0]*i+o[1]*r+o[2]*s,e.y=o[3]*i+o[4]*r+o[5]*s,e.z=o[6]*i+o[7]*r+o[8]*s,e},t.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},t.prototype.mmult=function(e,o){for(var i=o||new t,n=0;n<3;n++)for(var r=0;r<3;r++){for(var s=0,a=0;a<3;a++)s+=e.elements[n+3*a]*this.elements[a+3*r];i.elements[n+3*r]=s}return i},t.prototype.scale=function(e,o){o=o||new t;for(var i=this.elements,n=o.elements,r=0;3!==r;r++)n[3*r+0]=e.x*i[3*r+0],n[3*r+1]=e.y*i[3*r+1],n[3*r+2]=e.z*i[3*r+2];return o},t.prototype.solve=function(t,e){e=e||new n;for(var o,i=[],r=0;r<12;r++)i.push(0);for(r=0;r<3;r++)for(o=0;o<3;o++)i[r+4*o]=this.elements[r+3*o];i[3]=t.x,i[7]=t.y,i[11]=t.z;var s,a,p=3,h=p;do{if(0===i[(r=h-p)+4*r])for(o=r+1;o<h;o++)if(0!==i[r+4*o]){s=4;do{i[(a=4-s)+4*r]+=i[a+4*o]}while(--s);break}if(0!==i[r+4*r])for(o=r+1;o<h;o++){var l=i[r+4*o]/i[r+4*r];s=4;do{i[(a=4-s)+4*o]=a<=r?0:i[a+4*o]-i[a+4*r]*l}while(--s)}}while(--p);if(e.z=i[11]/i[10],e.y=(i[7]-i[6]*e.z)/i[5],e.x=(i[3]-i[2]*e.z-i[1]*e.y)/i[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw new Error("Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]");return e},t.prototype.e=function(t,e,o){return void 0===o?this.elements[e+3*t]:this.elements[e+3*t]=o},t.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},t.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},t.prototype.reverse=function(e){e=e||new t;var o,i=[],n=0;for(n=0;n<18;n++)i.push(0);for(n=0;n<3;n++)for(o=0;o<3;o++)i[n+6*o]=this.elements[n+3*o];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;var r,s,a=3,p=a;do{if(0===i[(n=p-a)+6*n])for(o=n+1;o<p;o++)if(0!==i[n+6*o]){r=6;do{i[(s=6-r)+6*n]+=i[s+6*o]}while(--r);break}if(0!==i[n+6*n])for(o=n+1;o<p;o++){var h=i[n+6*o]/i[n+6*n];r=6;do{i[(s=6-r)+6*o]=s<=n?0:i[s+6*o]-i[s+6*n]*h}while(--r)}}while(--a);n=2;do{o=n-1;do{h=i[n+6*o]/i[n+6*n],r=6;do{i[(s=6-r)+6*o]=i[s+6*o]-i[s+6*n]*h}while(--r)}while(o--)}while(--n);n=2;do{h=1/i[n+6*n],r=6;do{i[(s=6-r)+6*n]=i[s+6*n]*h}while(--r)}while(n--);n=2;do{o=2;do{if(s=i[3+o+6*n],isNaN(s)||s===1/0)throw new Error("Could not reverse! A=["+this.toString()+"]");e.e(n,o,s)}while(o--)}while(n--);return e},t.prototype.setRotationFromQuaternion=function(t){var e=t.x,o=t.y,i=t.z,n=t.w,r=e+e,s=o+o,a=i+i,p=e*r,h=e*s,l=e*a,c=o*s,u=o*a,d=i*a,v=n*r,y=n*s,f=n*a,m=this.elements;return m[0]=1-(c+d),m[1]=h-f,m[2]=l+y,m[3]=h+f,m[4]=1-(p+d),m[5]=u-v,m[6]=l-y,m[7]=u+v,m[8]=1-(p+c),this},t.prototype.transpose=function(e){for(var o=(e=e||new t).elements,i=this.elements,n=0;3!==n;n++)for(var r=0;3!==r;r++)o[3*n+r]=i[3*r+n];return e},t}(),n=function(){function t(t,e,o){this.x=t||0,this.y=e||0,this.z=o||0}return t.prototype.cross=function(e,o){var i=e.x,n=e.y,r=e.z,s=this.x,a=this.y,p=this.z;return(o=o||new t).x=a*r-p*n,o.y=p*i-s*r,o.z=s*n-a*i,o},t.prototype.set=function(t,e,o){return this.x=t,this.y=e,this.z=o,this},t.prototype.setZero=function(){this.x=this.y=this.z=0},t.prototype.vadd=function(e,o){return o?(o.x=e.x+this.x,o.y=e.y+this.y,o.z=e.z+this.z,o):new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.vsub=function(e,o){return o?(o.x=this.x-e.x,o.y=this.y-e.y,o.z=this.z-e.z,o):new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},t.prototype.normalize=function(){var t=this.x,e=this.y,o=this.z,i=Math.sqrt(t*t+e*e+o*o);if(i>0){var n=1/i;this.x*=n,this.y*=n,this.z*=n}else this.x=0,this.y=0,this.z=0;return i},t.prototype.unit=function(e){e=e||new t;var o=this.x,i=this.y,n=this.z,r=Math.sqrt(o*o+i*i+n*n);return r>0?(r=1/r,e.x=o*r,e.y=i*r,e.z=n*r):(e.x=1,e.y=0,e.z=0),e},t.prototype.norm=function(){var t=this.x,e=this.y,o=this.z;return Math.sqrt(t*t+e*e+o*o)},t.prototype.length=function(){return this.norm()},t.prototype.norm2=function(){return this.dot(this)},t.prototype.distanceTo=function(t){var e=this.x,o=this.y,i=this.z,n=t.x,r=t.y,s=t.z;return Math.sqrt((n-e)*(n-e)+(r-o)*(r-o)+(s-i)*(s-i))},t.prototype.distanceSquared=function(t){var e=this.x,o=this.y,i=this.z,n=t.x,r=t.y,s=t.z;return(n-e)*(n-e)+(r-o)*(r-o)+(s-i)*(s-i)},t.prototype.mult=function(e,o){o=o||new t;var i=this.x,n=this.y,r=this.z;return o.x=e*i,o.y=e*n,o.z=e*r,o},t.prototype.vmul=function(e,o){return(o=o||new t).x=e.x*this.x,o.y=e.y*this.y,o.z=e.z*this.z,o},t.prototype.scale=function(t,e){return this.mult(t,e)},t.prototype.addScaledVector=function(e,o,i){return(i=i||new t).x=this.x+e*o.x,i.y=this.y+e*o.y,i.z=this.z+e*o.z,i},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},t.prototype.negate=function(e){return(e=e||new t).x=-this.x,e.y=-this.y,e.z=-this.z,e},t.prototype.tangents=function(e,o){var i=new t,n=new t,r=this.norm();if(r>0){var s=i,a=1/r;s.set(this.x*a,this.y*a,this.z*a);var p=n;Math.abs(s.x)<.9?(p.set(1,0,0),s.cross(p,e)):(p.set(0,1,0),s.cross(p,e)),s.cross(e,o)}else e.set(1,0,0),o.set(0,1,0)},t.prototype.toString=function(){return this.x+","+this.y+","+this.z},t.prototype.toArray=function(){return[this.x,this.y,this.z]},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.lerp=function(t,e,o){var i=this.x,n=this.y,r=this.z;o.x=i+(t.x-i)*e,o.y=n+(t.y-n)*e,o.z=r+(t.z-r)*e},t.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},t.prototype.almostZero=function(t){return void 0===t&&(t=0),void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)},t.prototype.isAntiparallelTo=function(e,o){void 0===o&&(o=0);var i=new t;return this.negate(i),i.almostEquals(e,o)},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t}(),r=function(){function t(){}return t.ZERO=new n(0,0,0),t.UNIT_X=new n(1,0,0),t.UNIT_Y=new n(0,1,0),t.UNIT_Z=new n(0,0,1),t}(),s=function(){function t(t){this.tmp=new n,this.transformIntoFrame_corners=[new n,new n,new n,new n,new n,new n,new n,new n],t=t||{},this.lowerBound=new n,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new n,t.upperBound&&this.upperBound.copy(t.upperBound)}return t.prototype.setFromPoints=function(t,e,o,i){var n=this.lowerBound,r=this.upperBound,s=o;n.copy(t[0]),s&&s.vmult(n,n),r.copy(n);for(var a=1;a<t.length;a++){var p=t[a];s&&(s.vmult(p,this.tmp),p=this.tmp),p.x>r.x&&(r.x=p.x),p.x<n.x&&(n.x=p.x),p.y>r.y&&(r.y=p.y),p.y<n.y&&(n.y=p.y),p.z>r.z&&(r.z=p.z),p.z<n.z&&(n.z=p.z)}return e&&(e.vadd(n,n),e.vadd(r,r)),i&&(n.x-=i,n.y-=i,n.z-=i,r.x+=i,r.y+=i,r.z+=i),this},t.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},t.prototype.clone=function(){return(new t).copy(this)},t.prototype.extend=function(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)},t.prototype.overlaps=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound,r=i.x<=o.x&&o.x<=n.x||e.x<=n.x&&n.x<=o.x,s=i.y<=o.y&&o.y<=n.y||e.y<=n.y&&n.y<=o.y,a=i.z<=o.z&&o.z<=n.z||e.z<=n.z&&n.z<=o.z;return r&&s&&a},t.prototype.volume=function(){var t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)},t.prototype.contains=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound;return e.x<=i.x&&o.x>=n.x&&e.y<=i.y&&o.y>=n.y&&e.z<=i.z&&o.z>=n.z},t.prototype.getCorners=function(t,e,o,i,n,r,s,a){var p=this.lowerBound,h=this.upperBound;t.copy(p),e.set(h.x,p.y,p.z),o.set(h.x,h.y,p.z),i.set(p.x,h.y,h.z),n.set(h.x,p.y,p.z),r.set(p.x,h.y,p.z),s.set(p.x,p.y,h.z),a.copy(h)},t.prototype.toLocalFrame=function(t,e){var o=this.transformIntoFrame_corners,i=o[0],n=o[1],r=o[2],s=o[3],a=o[4],p=o[5],h=o[6],l=o[7];this.getCorners(i,n,r,s,a,p,h,l);for(var c=0;8!==c;c++){var u=o[c];t.pointToLocal(u,u)}return e.setFromPoints(o)},t.prototype.toWorldFrame=function(t,e){var o=this.transformIntoFrame_corners,i=o[0],n=o[1],r=o[2],s=o[3],a=o[4],p=o[5],h=o[6],l=o[7];this.getCorners(i,n,r,s,a,p,h,l);for(var c=0;8!==c;c++){var u=o[c];t.pointToWorld(u,u)}return e.setFromPoints(o)},t.prototype.overlapsRay=function(t){var e=1/t._direction.x,o=1/t._direction.y,i=1/t._direction.z,n=(this.lowerBound.x-t.from.x)*e,r=(this.upperBound.x-t.from.x)*e,s=(this.lowerBound.y-t.from.y)*o,a=(this.upperBound.y-t.from.y)*o,p=(this.lowerBound.z-t.from.z)*i,h=(this.upperBound.z-t.from.z)*i,l=Math.max(Math.max(Math.min(n,r),Math.min(s,a)),Math.min(p,h)),c=Math.min(Math.min(Math.max(n,r),Math.max(s,a)),Math.max(p,h));return!(c<0||l>c)},t}(),a=function(){function t(){this.matrix=[]}return t.prototype.get=function(t,e){var o=t.index,i=e.index;if(i>o){var n=i;i=o,o=n}return this.matrix[(o*(o+1)>>1)+i-1]},t.prototype.set=function(t,e,o){var i=t.index,n=e.index;if(n>i){var r=n;n=i,i=r}this.matrix[(i*(i+1)>>1)+n-1]=o?1:0},t.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},t.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1},t}(),p=function(){function t(){}return t.prototype.addEventListener=function(t,e){void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[t]&&(o[t]=[]),-1===o[t].indexOf(e)&&o[t].push(e),this},t.prototype.hasEventListener=function(t,e){if(void 0===this._listeners)return!1;var o=this._listeners;return void 0!==o[t]&&-1!==o[t].indexOf(e)},t.prototype.hasAnyEventListener=function(t){return void 0!==this._listeners&&void 0!==this._listeners[t]},t.prototype.removeEventListener=function(t,e){if(void 0===this._listeners)return this;var o=this._listeners;if(void 0===o[t])return this;var i=o[t].indexOf(e);return-1!==i&&o[t].splice(i,1),this},t.prototype.dispatchEvent=function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var o=0,i=e.length;o<i;o++)e[o].call(this,t)}return this},t}(),h=function(){function t(t,e,o,i){this.sfv_t1=new n,this.sfv_t2=new n,this.Quaternion_mult_va=new n,this.Quaternion_mult_vb=new n,this.Quaternion_mult_vaxvb=new n,this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==o?o:0,this.w=void 0!==i?i:1}return t.prototype.set=function(t,e,o,i){return this.x=t,this.y=e,this.z=o,this.w=i,this},t.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},t.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.setFromAxisAngle=function(t,e){var o=Math.sin(.5*e);return this.x=t.x*o,this.y=t.y*o,this.z=t.z*o,this.w=Math.cos(.5*e),this},t.prototype.toAxisAngle=function(t){t=t||new n,this.normalize();var e=2*Math.acos(this.w),o=Math.sqrt(1-this.w*this.w);return o<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/o,t.y=this.y/o,t.z=this.z/o),[t,e]},t.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var o=this.sfv_t1,i=this.sfv_t2;t.tangents(o,i),this.setFromAxisAngle(o,Math.PI)}else{var n=t.cross(e);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}return this},t.prototype.mult=function(e,o){o=o||new t;var i=this.x,n=this.y,r=this.z,s=this.w,a=e.x,p=e.y,h=e.z,l=e.w;return o.x=i*l+s*a+n*h-r*p,o.y=n*l+s*p+r*a-i*h,o.z=r*l+s*h+i*p-n*a,o.w=s*l-i*a-n*p-r*h,o},t.prototype.inverse=function(e){var o=this.x,i=this.y,n=this.z,r=this.w;e=e||new t,this.conjugate(e);var s=1/(o*o+i*i+n*n+r*r);return e.x*=s,e.y*=s,e.z*=s,e.w*=s,e},t.prototype.conjugate=function(e){return(e=e||new t).x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e},t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},t.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},t.prototype.vmult=function(t,e){e=e||new n;var o=t.x,i=t.y,r=t.z,s=this.x,a=this.y,p=this.z,h=this.w,l=h*o+a*r-p*i,c=h*i+p*o-s*r,u=h*r+s*i-a*o,d=-s*o-a*i-p*r;return e.x=l*h+d*-s+c*-p-u*-a,e.y=c*h+d*-a+u*-s-l*-p,e.z=u*h+d*-p+l*-a-c*-s,e},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.toEuler=function(t,e){var o,i,n;void 0===e&&(e="YZX");var r=this.x,s=this.y,a=this.z,p=this.w;switch(e){case"YZX":var h=r*s+a*p;if(h>.499&&(o=2*Math.atan2(r,p),i=Math.PI/2,n=0),h<-.499&&(o=-2*Math.atan2(r,p),i=-Math.PI/2,n=0),isNaN(o)){var l=r*r,c=s*s,u=a*a;o=Math.atan2(2*s*p-2*r*a,1-2*c-2*u),i=Math.asin(2*h),n=Math.atan2(2*r*p-2*s*a,1-2*l-2*u)}break;default:throw new Error("Euler order "+e+" not supported yet.")}t.y=o,t.z=i,t.x=n},t.prototype.setFromEuler=function(t,e,o,i){void 0===i&&(i="XYZ");var n=Math.cos(t/2),r=Math.cos(e/2),s=Math.cos(o/2),a=Math.sin(t/2),p=Math.sin(e/2),h=Math.sin(o/2);return"XYZ"===i?(this.x=a*r*s+n*p*h,this.y=n*p*s-a*r*h,this.z=n*r*h+a*p*s,this.w=n*r*s-a*p*h):"YXZ"===i?(this.x=a*r*s+n*p*h,this.y=n*p*s-a*r*h,this.z=n*r*h-a*p*s,this.w=n*r*s+a*p*h):"ZXY"===i?(this.x=a*r*s-n*p*h,this.y=n*p*s+a*r*h,this.z=n*r*h+a*p*s,this.w=n*r*s-a*p*h):"ZYX"===i?(this.x=a*r*s-n*p*h,this.y=n*p*s+a*r*h,this.z=n*r*h-a*p*s,this.w=n*r*s+a*p*h):"YZX"===i?(this.x=a*r*s+n*p*h,this.y=n*p*s+a*r*h,this.z=n*r*h-a*p*s,this.w=n*r*s-a*p*h):"XZY"===i&&(this.x=a*r*s-n*p*h,this.y=n*p*s-a*r*h,this.z=n*r*h+a*p*s,this.w=n*r*s+a*p*h),this},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.slerp=function(e,o,i){i=i||new t;var n,r,s,a,p,h=this.x,l=this.y,c=this.z,u=this.w,d=e.x,v=e.y,y=e.z,f=e.w;return(r=h*d+l*v+c*y+u*f)<0&&(r=-r,d=-d,v=-v,y=-y,f=-f),1-r>1e-6?(n=Math.acos(r),s=Math.sin(n),a=Math.sin((1-o)*n)/s,p=Math.sin(o*n)/s):(a=1-o,p=o),i.x=a*h+p*d,i.y=a*l+p*v,i.z=a*c+p*y,i.w=a*u+p*f,i},t.prototype.integrate=function(e,o,i,n){n=n||new t;var r=e.x*i.x,s=e.y*i.y,a=e.z*i.z,p=this.x,h=this.y,l=this.z,c=this.w,u=.5*o;return n.x+=u*(r*c+s*l-a*h),n.y+=u*(s*c+a*p-r*l),n.z+=u*(a*c+r*h-s*p),n.w+=u*(-r*p-s*h-a*l),n},t}(),l=function(){function t(e){e=e||{},this.id=t.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}return t.prototype.updateBoundingSphereRadius=function(){throw new Error("computeBoundingSphereRadius() not implemented for shape type "+this.type)},t.prototype.volume=function(){throw new Error("volume() not implemented for shape type "+this.type)},t.prototype.calculateLocalInertia=function(t,e){throw new Error("calculateLocalInertia() not implemented for shape type "+this.type)},t.prototype.calculateWorldAABB=function(t,e,o,i){throw new Error("calculateLocalInertia() not implemented for shape type "+this.type)},t.idCounter=0,t.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256},t}(),c=function(){function t(t){t=t||{},this.position=new n,t.position&&this.position.copy(t.position),this.quaternion=new h,t.quaternion&&this.quaternion.copy(t.quaternion)}return t.pointToLocalFrame=function(t,e,o,i){var r=new h;return i=i||new n,o.vsub(t,i),e.conjugate(r),r.vmult(i,i),i},t.pointToWorldFrame=function(t,e,o,i){return i=i||new n,e.vmult(o,i),i.vadd(t,i),i},t.vectorToWorldFrame=function(t,e,o){return o=o||new n,t.vmult(e,o),o},t.vectorToLocalFrame=function(t,e,o,i){return i=i||new n,e.w*=-1,e.vmult(o,i),e.w*=-1,i},t.prototype.pointToLocal=function(e,o){return t.pointToLocalFrame(this.position,this.quaternion,e,o)},t.prototype.pointToWorld=function(e,o){return t.pointToWorldFrame(this.position,this.quaternion,e,o)},t}(),u=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),d=function(){},v=function(t){function e(e,o,i,r){var s=t.call(this,{type:l.types.CONVEXPOLYHEDRON})||this;return s.cli_aabbmin=new n,s.cli_aabbmax=new n,s.vertices=e||[],s.worldVertices=[],s.worldVerticesNeedsUpdate=!0,s.faces=o||[],s.faceNormals=r||[],s.computeNormals(),s.worldFaceNormalsNeedsUpdate=!0,s.worldFaceNormals=[],s.uniqueEdges=[],s.uniqueAxes=i?i.slice():null,s.computeEdges(),s.updateBoundingSphereRadius(),s}return u(e,t),e.prototype.computeEdges=function(){var t=new n,e=this.faces,o=this.vertices,i=(o.length,this.uniqueEdges);i.length=0;for(var r=t,s=0;s!==e.length;s++)for(var a=e[s],p=a.length,h=0;h!==p;h++){var l=(h+1)%p;o[a[h]].vsub(o[a[l]],r),r.normalize();for(var c=!1,u=0;u!==i.length;u++)if(i[u].almostEquals(r)||i[u].almostEquals(r)){c=!0;break}c||i.push(r.clone())}},e.prototype.computeNormals=function(){if(!this.faceNormals.length){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var o=this.faceNormals[t]||new n;this.getFaceNormal(t,o),o.negate(o),this.faceNormals[t]=o;var i=this.vertices[this.faces[t][0]];if(o.dot(i)<0)for(console.warn(".faceNormals["+t+"] = Vec3("+o.toString()+") looks like it points into the shape? The vertices follow. Make sure they are  ordered CCW around the normal, using the right hand rule."),e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}}},e.computeNormal=function(t,e,o,i){var r=new n,s=new n;e.vsub(t,s),o.vsub(e,r),r.cross(s,i),i.isZero()||i.normalize()},e.prototype.getFaceNormal=function(t,o){var i=this.faces[t],n=this.vertices[i[0]],r=this.vertices[i[1]],s=this.vertices[i[2]];return e.computeNormal(n,r,s,o)},e.prototype.clipAgainstHull=function(t,e,o,i,r,s,a,p,h){for(var l=new n,c=-1,u=-Number.MAX_VALUE,d=0;d<o.faces.length;d++){l.copy(o.faceNormals[d]),r.vmult(l,l);var v=l.dot(s);v>u&&(u=v,c=d)}for(var y=[],f=o.faces[c],m=f.length,w=0;w<m;w++){var _=o.vertices[f[w]],b=new n;b.copy(_),r.vmult(b,b),i.vadd(b,b),y.push(b)}c>=0&&this.clipFaceAgainstHull(s,t,e,y,a,p,h)},e.prototype.findSeparatingAxis=function(t,e,o,i,r,s,a,p){var h=new n,l=new n,c=new n,u=new n,d=new n,v=new n,y=Number.MAX_VALUE;if(this.uniqueAxes)for(m=0;m!==this.uniqueAxes.length;m++){if(o.vmult(this.uniqueAxes[m],h),!1===(b=this.testSepAxis(h,t,e,o,i,r)))return!1;b<y&&(y=b,s.copy(h))}else for(var f=a?a.length:this.faces.length,m=0;m<f;m++){var w=a?a[m]:m;if(h.copy(this.faceNormals[w]),o.vmult(h,h),!1===(b=this.testSepAxis(h,t,e,o,i,r)))return!1;b<y&&(y=b,s.copy(h))}if(t.uniqueAxes)for(m=0;m!==t.uniqueAxes.length;m++){if(r.vmult(t.uniqueAxes[m],l),!1===(b=this.testSepAxis(l,t,e,o,i,r)))return!1;b<y&&(y=b,s.copy(l))}else{var _=p?p.length:t.faces.length;for(m=0;m<_;m++){var b;if(w=p?p[m]:m,l.copy(t.faceNormals[w]),r.vmult(l,l),!1===(b=this.testSepAxis(l,t,e,o,i,r)))return!1;b<y&&(y=b,s.copy(l))}}for(var x=0;x!==this.uniqueEdges.length;x++){o.vmult(this.uniqueEdges[x],u);for(var g=0;g!==t.uniqueEdges.length;g++)if(r.vmult(t.uniqueEdges[g],d),u.cross(d,v),!v.almostZero()){v.normalize();var B=this.testSepAxis(v,t,e,o,i,r);if(!1===B)return!1;B<y&&(y=B,s.copy(v))}}return i.vsub(e,c),c.dot(s)>0&&s.negate(s),!0},e.prototype.testSepAxis=function(t,o,i,n,r,s){var a=[],p=[];e.project(this,t,i,n,a),e.project(o,t,r,s,p);var h=a[0],l=a[1],c=p[0],u=p[1];if(h<u||c<l)return!1;var d=h-u,v=c-l;return d<v?d:v},e.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(this.cli_aabbmin,this.cli_aabbmax);var o=this.cli_aabbmax.x-this.cli_aabbmin.x,i=this.cli_aabbmax.y-this.cli_aabbmin.y,n=this.cli_aabbmax.z-this.cli_aabbmin.z;e.x=1/12*t*(2*i*2*i+2*n*2*n),e.y=1/12*t*(2*o*2*o+2*n*2*n),e.z=1/12*t*(2*i*2*i+2*o*2*o)},e.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],o=this.faceNormals[t],i=this.vertices[e[0]];return-o.dot(i)},e.prototype.clipFaceAgainstHull=function(t,e,o,i,r,s,a){for(var p=new n,h=new n,l=new n,c=new n,u=new n,d=new n,v=new n,y=new n,f=i,m=[],w=-1,_=Number.MAX_VALUE,b=0;b<this.faces.length;b++){p.copy(this.faceNormals[b]),o.vmult(p,p);var x=p.dot(t);x<_&&(_=x,w=b)}if(!(w<0)){for(var g=this.faces[w],B=[],A=0;A<this.faces.length;A++)for(var E=0;E<this.faces[A].length;E++)-1!==g.indexOf(this.faces[A][E])&&A!==w&&-1===B.indexOf(A)&&B.push(A);f.length;for(var P,z=g.length,C=0;C<z;C++){var S=this.vertices[g[C]],q=this.vertices[g[(C+1)%z]];S.vsub(q,h),l.copy(h),o.vmult(l,l),e.vadd(l,l),c.copy(this.faceNormals[w]),o.vmult(c,c),e.vadd(c,c),l.cross(c,u),u.negate(u),d.copy(S),o.vmult(d,d),e.vadd(d,d);var F=-d.dot(u),M=B[C];if(void 0!=M){v.copy(this.faceNormals[M]);var j=this.getPlaneConstantOfFace(M);y.copy(v),o.vmult(y,y),P=j-y.dot(e)}else y.copy(u),P=F;for(this.clipFaceAgainstPlane(f,m,y,P);f.length;)f.shift();for(;m.length;)f.push(m.shift())}v.copy(this.faceNormals[w]);var N=this.getPlaneConstantOfFace(w);for(y.copy(v),o.vmult(y,y),P=N-y.dot(e),A=0;A<f.length;A++){var O=y.dot(f[A])+P;if(O<=r&&(O=r),O<=s){var I=f[A];if(O<=0){var T={point:I,normal:y,depth:O};a.push(T)}}}}},e.prototype.clipFaceAgainstPlane=function(t,e,o,i){var r,s,a=t.length;if(a<2)return e;var p=t[t.length-1],h=t[0];r=o.dot(p)+i;for(var l=0;l<a;l++){if(h=t[l],s=o.dot(h)+i,r<0)if(s<0)(c=new n).copy(h),e.push(c);else{var c=new n;p.lerp(h,r/(r-s),c),e.push(c)}else s<0&&(c=new n,p.lerp(h,r/(r-s),c),e.push(c),e.push(h));p=h,r=s}return e},e.prototype.computeWorldVertices=function(t,e){for(var o=this.vertices.length;this.worldVertices.length<o;)this.worldVertices.push(new n);for(var i=this.vertices,r=this.worldVertices,s=0;s!==o;s++)e.vmult(i[s],r[s]),t.vadd(r[s],r[s]);this.worldVerticesNeedsUpdate=!1},e.prototype.computeLocalAABB=function(t,e){new n;var o=this.vertices.length,i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;r<o;r++){var s=i[r];s.x<t.x?t.x=s.x:s.x>e.x&&(e.x=s.x),s.y<t.y?t.y=s.y:s.y>e.y&&(e.y=s.y),s.z<t.z?t.z=s.z:s.z>e.z&&(e.z=s.z)}},e.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new n);for(var o=this.faceNormals,i=this.worldFaceNormals,r=0;r!==e;r++)t.vmult(o[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1},e.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,o=0,i=e.length;o!==i;o++){var n=e[o].norm2();n>t&&(t=n)}this.boundingSphereRadius=Math.sqrt(t)},e.prototype.calculateWorldAABB=function(t,e,o,i){for(var r,s,a,p,h,l,c=new n,u=this.vertices.length,d=this.vertices,v=0;v<u;v++){c.copy(d[v]),e.vmult(c,c),t.vadd(c,c);var y=c;(y.x<r||void 0===r)&&(r=y.x),(y.x>p||void 0===p)&&(p=y.x),(y.y<s||void 0===s)&&(s=y.y),(y.y>h||void 0===h)&&(h=y.y),(y.z<a||void 0===a)&&(a=y.z),(y.z>l||void 0===l)&&(l=y.z)}o.set(r,s,a),i.set(p,h,l)},e.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},e.prototype.getAveragePointLocal=function(t){t=t||new n;for(var e=this.vertices.length,o=this.vertices,i=0;i<e;i++)t.vadd(o[i],t);return t.mult(1/e,t),t},e.prototype.transformAllPoints=function(t,e){var o=this.vertices.length,i=this.vertices;if(e){for(var n=0;n<o;n++){var r=i[n];e.vmult(r,r)}for(n=0;n<this.faceNormals.length;n++)r=this.faceNormals[n],e.vmult(r,r)}if(t)for(n=0;n<o;n++)(r=i[n]).vadd(t,r)},e.prototype.pointIsInside=function(t){var e=new n,o=new n,i=new n,r=this.vertices,s=this.faces,a=this.faceNormals,p=this.faces.length,h=e;this.getAveragePointLocal(h);for(var l=0;l<p;l++){this.faces[l].length;var c=a[l],u=r[s[l][0]],d=o;t.vsub(u,d);var v=c.dot(d),y=i;h.vsub(u,y);var f=c.dot(y);if(v<0&&f>0||v>0&&f<0)return!1}return-1},e.project=function(t,e,o,i,r){new n;var s=new n,a=new n,p=t.vertices.length,h=s,l=a,u=t.vertices,d=0,v=0;l.setZero(),c.vectorToLocalFrame(o,i,e,h),c.pointToLocalFrame(o,i,l,l);var y=l.dot(h);v=d=u[0].dot(h);for(var f=1;f<p;f++){var m=u[f].dot(h);m>d&&(d=m),m<v&&(v=m)}if((v-=y)>(d-=y)){var w=v;v=d,d=w}r[0]=d,r[1]=v},e}(l),y=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),f=function(t){function e(e){var o=t.call(this,{type:l.types.BOX})||this;return o.worldCornerTempPos=new n,o.worldCornerTempNeg=new n,o.worldCornersTemp=[new n,new n,new n,new n,new n,new n,new n,new n],o.halfExtents=e,o.convexPolyhedronRepresentation=null,o.updateConvexPolyhedronRepresentation(),o.updateBoundingSphereRadius(),o}return y(e,t),e.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,o=this.halfExtents.z,i=n,r=[new i(-t,-e,-o),new i(t,-e,-o),new i(t,e,-o),new i(-t,e,-o),new i(-t,-e,o),new i(t,-e,o),new i(t,e,o),new i(-t,e,o)],s=(new i(0,0,1),new i(0,1,0),new i(1,0,0),new v(r,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=s,s.material=this.material},e.prototype.calculateLocalInertia=function(t,o){return o=o||new n,e.calculateInertia(this.halfExtents,t,o),o},e.calculateInertia=function(t,e,o){var i=t;o.x=1/12*e*(2*i.y*2*i.y+2*i.z*2*i.z),o.y=1/12*e*(2*i.x*2*i.x+2*i.z*2*i.z),o.z=1/12*e*(2*i.y*2*i.y+2*i.x*2*i.x)},e.prototype.getSideNormals=function(t,e){var o=t,i=this.halfExtents;if(o[0].set(i.x,0,0),o[1].set(0,i.y,0),o[2].set(0,0,i.z),o[3].set(-i.x,0,0),o[4].set(0,-i.y,0),o[5].set(0,0,-i.z),void 0!==e)for(var n=0;n!==o.length;n++)e.vmult(o[n],o[n]);return o},e.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()},e.prototype.forEachWorldCorner=function(t,e,o){for(var i=this.halfExtents,n=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],r=0;r<n.length;r++)this.worldCornerTempPos.set(n[r][0],n[r][1],n[r][2]),e.vmult(this.worldCornerTempPos,this.worldCornerTempPos),t.vadd(this.worldCornerTempPos,this.worldCornerTempPos),o(this.worldCornerTempPos.x,this.worldCornerTempPos.y,this.worldCornerTempPos.z)},e.prototype.calculateWorldAABB=function(t,e,o,i){var n=this.halfExtents;this.worldCornersTemp[0].set(n.x,n.y,n.z),this.worldCornersTemp[1].set(-n.x,n.y,n.z),this.worldCornersTemp[2].set(-n.x,-n.y,n.z),this.worldCornersTemp[3].set(-n.x,-n.y,-n.z),this.worldCornersTemp[4].set(n.x,-n.y,-n.z),this.worldCornersTemp[5].set(n.x,n.y,-n.z),this.worldCornersTemp[6].set(-n.x,n.y,-n.z),this.worldCornersTemp[7].set(n.x,-n.y,n.z);var r=this.worldCornersTemp[0];e.vmult(r,r),t.vadd(r,r),i.copy(r),o.copy(r);for(var s=1;s<8;s++){var a=this.worldCornersTemp[s];e.vmult(a,a),t.vadd(a,a);var p=a.x,h=a.y,l=a.z;p>i.x&&(i.x=p),h>i.y&&(i.y=h),l>i.z&&(i.z=l),p<o.x&&(o.x=p),h<o.y&&(o.y=h),l<o.z&&(o.z=l)}},e}(l),m=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),w=function(){},_=function(t){function e(o){var r=t.call(this)||this;r.tmpVec=new n,r.tmpQuat=new h,r.computeAABB_shapeAABB=new s,r.uiw_m1=new i,r.uiw_m2=new i,r.uiw_m3=new i,r.Body_applyForce_r=new n,r.Body_applyForce_rotForce=new n,r.Body_applyLocalForce_worldForce=new n,r.Body_applyLocalForce_relativePointWorld=new n,r.Body_applyImpulse_r=new n,r.Body_applyImpulse_velo=new n,r.Body_applyImpulse_rotVelo=new n,r.Body_applyLocalImpulse_worldImpulse=new n,r.Body_applyLocalImpulse_relativePoint=new n,r.Body_updateMassProperties_halfExtents=new n,r.invI_tau_dt=new n,r.w=new h,r.wq=new h,o=o||{},r.goid="",r.id=e.idCounter++,r.world=null,r.preStep=null,r.postStep=null,r.vlambda=new n,r.collisionFilterGroup="number"==typeof o.collisionFilterGroup?o.collisionFilterGroup:1,r.collisionFilterMask="number"==typeof o.collisionFilterMask?o.collisionFilterMask:-1,r.collisionResponse=!0,r.position=new n,r.previousPosition=new n,r.interpolatedPosition=new n,r.initPosition=new n,o.position&&(r.position.copy(o.position),r.previousPosition.copy(o.position),r.interpolatedPosition.copy(o.position),r.initPosition.copy(o.position)),r.velocity=new n,o.velocity&&r.velocity.copy(o.velocity),r.initVelocity=new n,r.force=new n;var a="number"==typeof o.mass?o.mass:0;return r.mass=a,r.invMass=a>0?1/a:0,r.material=o.material||null,r.linearDamping="number"==typeof o.linearDamping?o.linearDamping:.01,r.type=a<=0?e.STATIC:e.DYNAMIC,typeof o.type==typeof e.STATIC&&(r.type=o.type),r.allowSleep=void 0===o.allowSleep||o.allowSleep,r.sleepState=0,r.sleepSpeedLimit=void 0!==o.sleepSpeedLimit?o.sleepSpeedLimit:.1,r.sleepTimeLimit=void 0!==o.sleepTimeLimit?o.sleepTimeLimit:1,r.timeLastSleepy=0,r._wakeUpAfterNarrowphase=!1,r.torque=new n,r.quaternion=new h,r.initQuaternion=new h,r.previousQuaternion=new h,r.interpolatedQuaternion=new h,o.quaternion&&(r.quaternion.copy(o.quaternion),r.initQuaternion.copy(o.quaternion),r.previousQuaternion.copy(o.quaternion),r.interpolatedQuaternion.copy(o.quaternion)),r.angularVelocity=new n,o.angularVelocity&&r.angularVelocity.copy(o.angularVelocity),r.initAngularVelocity=new n,r.shapes=[],r.shapeOffsets=[],r.shapeOrientations=[],r.inertia=new n,r.invInertia=new n,r.invInertiaWorld=new i,r.invMassSolve=0,r.invInertiaSolve=new n,r.invInertiaWorldSolve=new i,r.fixedRotation=void 0!==o.fixedRotation&&o.fixedRotation,r.angularDamping=void 0!==o.angularDamping?o.angularDamping:.01,r.linearFactor=new n(1,1,1),o.linearFactor&&r.linearFactor.copy(o.linearFactor),r.angularFactor=new n(1,1,1),o.angularFactor&&r.angularFactor.copy(o.angularFactor),r.aabb=new s,r.aabbNeedsUpdate=!0,r.boundingRadius=0,r.wlambda=new n,o.shape&&r.addShape(o.shape),r.updateMassProperties(),r}return m(e,t),e.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,this._wakeUpAfterNarrowphase=!1,t===e.SLEEPING&&this.dispatchEvent(e.wakeupEvent)},e.prototype.sleep=function(){this.sleepState=e.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this._wakeUpAfterNarrowphase=!1},e.prototype.sleepTick=function(t){if(this.allowSleep){var o=this.sleepState,i=this.velocity.norm2()+this.angularVelocity.norm2(),n=Math.pow(this.sleepSpeedLimit,2);o===e.AWAKE&&i<n?(this.sleepState=e.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(e.sleepyEvent)):o===e.SLEEPY&&i>n?this.wakeUp():o===e.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(e.sleepEvent))}},e.prototype.updateSolveMassProperties=function(){this.sleepState===e.SLEEPING||this.type===e.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},e.prototype.pointToLocalFrame=function(t,e){return e=e||new n,t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},e.prototype.vectorToLocalFrame=function(t,e){return e=e||new n,this.quaternion.conjugate().vmult(t,e),e},e.prototype.pointToWorldFrame=function(t,e){return e=e||new n,this.quaternion.vmult(t,e),e.vadd(this.position,e),e},e.prototype.vectorToWorldFrame=function(t,e){return e=e||new n,this.quaternion.vmult(t,e),e},e.prototype.addShape=function(t,e,o){var i=new n,r=new h;return e&&i.copy(e),o&&r.copy(o),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this,this},e.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,o=t.length,i=0,n=0;n!==o;n++){var r=t[n];r.updateBoundingSphereRadius();var s=e[n].norm(),a=r.boundingSphereRadius;s+a>i&&(i=s+a)}this.boundingRadius=i},e.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,o=this.shapeOrientations,i=t.length,n=this.tmpVec,r=this.tmpQuat,s=this.quaternion,a=this.aabb,p=this.computeAABB_shapeAABB,h=0;h!==i;h++){var l=t[h];s.vmult(e[h],n),n.vadd(this.position,n),o[h].mult(s,r),l.calculateWorldAABB(n,r,p.lowerBound,p.upperBound),0===h?a.copy(p):a.extend(p)}this.aabbNeedsUpdate=!1},e.prototype.updateInertiaWorld=function(t){void 0===t&&(t=!1);var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var o=this.uiw_m1,i=this.uiw_m2;this.uiw_m3,o.setRotationFromQuaternion(this.quaternion),o.transpose(i),o.scale(e,o),o.mmult(i,this.invInertiaWorld)}},e.prototype.applyForce=function(t,o){if(this.type===e.DYNAMIC){var i=this.Body_applyForce_rotForce;o.cross(t,i),this.force.vadd(t,this.force),this.torque.vadd(i,this.torque)}},e.prototype.applyLocalForce=function(t,o){if(this.type===e.DYNAMIC){var i=this.Body_applyLocalForce_worldForce,n=this.Body_applyLocalForce_relativePointWorld;this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(o,n),this.applyForce(i,n)}},e.prototype.applyImpulse=function(t,o){if(this.type===e.DYNAMIC){var i=o,n=this.Body_applyImpulse_velo;n.copy(t),n.mult(this.invMass,n),this.velocity.vadd(n,this.velocity);var r=this.Body_applyImpulse_rotVelo;i.cross(t,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}},e.prototype.applyLocalImpulse=function(t,o){if(this.type===e.DYNAMIC){var i=this.Body_applyLocalImpulse_worldImpulse,n=this.Body_applyLocalImpulse_relativePoint;this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(o,n),this.applyImpulse(i,n)}},e.prototype.updateMassProperties=function(){var t=this.Body_updateMassProperties_halfExtents;this.invMass=this.mass>0?1/this.mass:0;var e=this.inertia,o=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),f.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!o?1/e.x:0,e.y>0&&!o?1/e.y:0,e.z>0&&!o?1/e.z:0),this.updateInertiaWorld(!0)},e.prototype.getVelocityAtWorldPoint=function(t,e){var o=new n;return t.vsub(this.position,o),this.angularVelocity.cross(o,e),this.velocity.vadd(e,e),e},e.prototype.integrate=function(t,o,i){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===e.DYNAMIC||this.type===e.KINEMATIC)&&this.sleepState!==e.SLEEPING){var n=this.velocity,r=this.angularVelocity,s=this.position,a=this.force,p=this.torque,h=this.quaternion,l=this.invMass,c=this.invInertiaWorld,u=this.linearFactor,d=l*t;n.x+=a.x*d*u.x,n.y+=a.y*d*u.y,n.z+=a.z*d*u.z;var v=c.elements,y=this.angularFactor,f=p.x*y.x,m=p.y*y.y,w=p.z*y.z;r.x+=t*(v[0]*f+v[1]*m+v[2]*w),r.y+=t*(v[3]*f+v[4]*m+v[5]*w),r.z+=t*(v[6]*f+v[7]*m+v[8]*w),s.x+=n.x*t,s.y+=n.y*t,s.z+=n.z*t,h.integrate(this.angularVelocity,t,this.angularFactor,h),o&&(i?h.normalizeFast():h.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}},e.idCounter=0,e.COLLIDE_EVENT_NAME="collide",e.DYNAMIC=1,e.STATIC=2,e.KINEMATIC=4,e.AWAKE=0,e.SLEEPY=1,e.SLEEPING=2,e.wakeupEvent={type:"wakeup"},e.sleepyEvent={type:"sleepy"},e.sleepEvent={type:"sleep"},e}(p),b=function(){function t(t){this.Broadphase_collisionPairs_r=new n,this.Broadphase_collisionPairs_normal=new n,this.Broadphase_collisionPairs_quat=new h,this.Broadphase_collisionPairs_relpos=new n,this.Broadphase_makePairsUnique_p1=[],this.Broadphase_makePairsUnique_p2=[],this.bsc_dist=new n,this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}return t.prototype.collisionPairs=function(t,e,o){throw new Error("collisionPairs not implemented for this BroadPhase class!")},t.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&_.STATIC)&&t.sleepState!==_.SLEEPING||0==(e.type&_.STATIC)&&e.sleepState!==_.SLEEPING)},t.prototype.intersectionTest=function(t,e,o,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,o,i):this.doBoundingSphereBroadphase(t,e,o,i)},t.prototype.doBoundingSphereBroadphase=function(t,e,o,i){var n=this.Broadphase_collisionPairs_r;e.position.vsub(t.position,n);var r=Math.pow(t.boundingRadius+e.boundingRadius,2);n.norm2()<r&&(o.push(t),i.push(e))},t.prototype.doBoundingBoxBroadphase=function(t,e,o,i){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(o.push(t),i.push(e))},t.prototype.makePairsUnique=function(t,e){for(var o=this.Broadphase_makePairsUnique_temp,i=this.Broadphase_makePairsUnique_p1,n=this.Broadphase_makePairsUnique_p2,r=t.length,s=0;s!==r;s++)i[s]=t[s],n[s]=e[s];for(t.length=0,e.length=0,s=0;s!==r;s++){var a=i[s].id,p=n[s].id;o[h=a<p?a+","+p:p+","+a]=s,o.keys.push(h)}for(s=0;s!==o.keys.length;s++){var h,l=o[h=o.keys.pop()];t.push(i[l]),e.push(n[l]),delete o[h]}},t.prototype.setWorld=function(t){},t.boundingSphereCheck=function(t,e){var o=new n;t.position.vsub(e.position,o);var i=t.shapes[0],r=e.shapes[0];return Math.pow(i.boundingSphereRadius+r.boundingSphereRadius,2)>o.norm2()},t.prototype.aabbQuery=function(t,e,o){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]},t}(),x=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),g=function(t){function e(e,o,i,r,s){void 0===i&&(i=10),void 0===r&&(r=10),void 0===s&&(s=10);var a=t.call(this)||this;a.GridBroadphase_collisionPairs_d=new n,a.GridBroadphase_collisionPairs_binPos=new n,a.aabbMin=e||new n(100,100,100),a.aabbMax=o||new n(-100,-100,-100);var p=a.nx*a.ny*a.nz;if(p<=0)throw new Error("GridBroadphase: Each dimensions n must be >0");a.bins=[],a.binLengths=[],a.bins.length=p,a.binLengths.length=p;for(var h=0;h<p;h++)a.bins[h]=[],a.binLengths[h]=0;return a}return x(e,t),e.prototype.collisionPairs=function(t,e,o){for(var i=t.numObjects(),n=t.bodies,r=this.aabbMax,s=this.aabbMin,a=this.nx,p=this.ny,h=this.nz,c=p*h,u=h,d=r.x,v=r.y,y=r.z,f=s.x,m=s.y,w=s.z,_=a/(d-f),b=p/(v-m),x=h/(y-w),g=(d-f)/a,B=(v-m)/p,A=(y-w)/h,E=.5*Math.sqrt(g*g+B*B+A*A),P=l.types,z=P.SPHERE,C=P.PLANE,S=(P.BOX,P.COMPOUND,P.CONVEXPOLYHEDRON,this.bins),q=this.binLengths,F=this.bins.length,M=0;M!==F;M++)q[M]=0;var j=Math.ceil,N=function(t,e,o,i,n,r,s){var l=(t-f)*_|0,d=(e-m)*b|0,v=(o-w)*x|0,y=j((i-f)*_),g=j((n-m)*b),B=j((r-w)*x);l<0?l=0:l>=a&&(l=a-1),d<0?d=0:d>=p&&(d=p-1),v<0?v=0:v>=h&&(v=h-1),y<0?y=0:y>=a&&(y=a-1),g<0?g=0:g>=p&&(g=p-1),B<0?B=0:B>=h&&(B=h-1),d*=u,v*=1,y*=c,g*=u,B*=1;for(var A=l*=c;A<=y;A+=c)for(var E=d;E<=g;E+=u)for(var P=v;P<=B;P+=1){var z=A+E+P;S[z][q[z]++]=s}};for(M=0;M!==i;M++){var O=(ot=n[M]).shapes[0];switch(O.type){case z:var I=O,T=ot.position.x,R=ot.position.y,L=ot.position.z,W=I.radius;N(T-W,R-W,L-W,T+W,R+W,L+W,ot);break;case C:var V=O;V.worldNormalNeedsUpdate&&V.computeWorldNormal(ot.quaternion);var k=V.worldNormal,U=f+.5*g-ot.position.x,G=m+.5*B-ot.position.y,H=w+.5*A-ot.position.z,X=this.GridBroadphase_collisionPairs_d;X.set(U,G,H);for(var D=0,Y=0;D!==a;D++,Y+=c,X.y=G,X.x+=g)for(var Z=0,Q=0;Z!==p;Z++,Q+=u,X.z=H,X.y+=B)for(var K=0,J=0;K!==h;K++,J+=1,X.z+=A)if(X.dot(k)<E){var $=Y+Q+J;S[$][q[$]++]=ot}break;default:ot.aabbNeedsUpdate&&ot.computeAABB(),N(ot.aabb.lowerBound.x,ot.aabb.lowerBound.y,ot.aabb.lowerBound.z,ot.aabb.upperBound.x,ot.aabb.upperBound.y,ot.aabb.upperBound.z,ot)}}for(M=0;M!==F;M++){var tt=q[M];if(tt>1){var et=S[M];for(D=0;D!==tt;D++){var ot=et[D];for(Z=0;Z!==D;Z++){var it=et[Z];this.needBroadphaseCollision(ot,it)&&this.intersectionTest(ot,it,e,o)}}}}this.makePairsUnique(e,o)},e}(b),B=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),A=function(t){function e(){return t.call(this)||this}return B(e,t),e.prototype.collisionPairs=function(t,e,o){var i,n,r,s,a=t.bodies,p=a.length;for(i=0;i!==p;i++)for(n=0;n!==i;n++)r=a[i],s=a[n],this.needBroadphaseCollision(r,s)&&this.intersectionTest(r,s,e,o)},e.prototype.aabbQuery=function(t,e,o){o=o||[];for(var i=0;i<t.bodies.length;i++){var n=t.bodies[i];n.aabbNeedsUpdate&&n.computeAABB(),n.aabb.overlaps(e)&&o.push(n)}return o},e}(b),E=function(){function t(){this.rayFromWorld=new n,this.rayToWorld=new n,this.hitNormalWorld=new n,this.hitPointWorld=new n,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}return t.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},t.prototype.abort=function(){this._shouldStop=!0},t.prototype.set=function(t,e,o,i,n,r,s){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(o),this.hitPointWorld.copy(i),this.shape=n,this.body=r,this.distance=s},t}(),P=function(){function t(e,o){this.tmpAABB=new s,this.tmpArray=[],this.v1=new n,this.v2=new n,this.intersectBody_xi=new n,this.intersectBody_qi=new h,this.vector=new n,this.normal=new n,this.intersectPoint=new n,this.a=new n,this.b=new n,this.c=new n,this.d=new n,this.tmpRaycastResult=new E,this.Ray_intersectSphere_intersectionPoint=new n,this.Ray_intersectSphere_normal=new n,this.intersectConvex_normal=new n,this.intersectConvex_minDistNormal=new n,this.intersectConvex_minDistIntersect=new n,this.intersectConvex_vector=new n,this.v0=new n,this.intersect=new n,this.from=e?e.clone():new n,this.to=o?o.clone():new n,this._direction=new n,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=t.ANY,this.result=new E,this.hasHit=!1,this.callback=function(t){}}return t.prototype.intersectWorld=function(e,o){return this.mode=o.mode||t.ANY,this.result=o.result||new E,this.skipBackfaces=!!o.skipBackfaces,this.collisionFilterMask=void 0!==o.collisionFilterMask?o.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==o.collisionFilterGroup?o.collisionFilterGroup:-1,o.from&&this.from.copy(o.from),o.to&&this.to.copy(o.to),this.callback=o.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(this.tmpAABB),this.tmpArray.length=0,e.broadphase.aabbQuery(e,this.tmpAABB,this.tmpArray),this.intersectBodies(this.tmpArray),this.hasHit},t.pointInTriangle=function(t,e,o,i){var r=new n,s=new n,a=new n;i.vsub(e,r),o.vsub(e,s),t.vsub(e,a);var p,h,l=r.dot(r),c=r.dot(s),u=r.dot(a),d=s.dot(s),v=s.dot(a);return(p=d*u-c*v)>=0&&(h=l*v-c*u)>=0&&p+h<l*d-c*c},t.prototype.intersectBody=function(t,e){e&&(this.result=e,this.updateDirection());var o=this.checkCollisionResponse;if((!o||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var i=this.intersectBody_xi,n=this.intersectBody_qi,r=0,s=t.shapes.length;r<s;r++){var a=t.shapes[r];if((!o||a.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[r],n),t.quaternion.vmult(t.shapeOffsets[r],i),i.vadd(t.position,i),this.intersectShape(a,n,i,t),this.result._shouldStop))break}},t.prototype.intersectBodies=function(t,e){e&&(this.result=e,this.updateDirection());for(var o=0,i=t.length;!this.result._shouldStop&&o<i;o++)this.intersectBody(t[o])},t.prototype.updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},t.prototype.intersectShape=function(t,e,o,i){var n=this.from;if(!(this.distanceFromIntersection(n,this._direction,o)>t.boundingSphereRadius))switch(t.type){case l.types.CONVEXPOLYHEDRON:this.intersectConvex(t,e,o,i,t);break;case l.types.BOX:this.intersectBox(t,e,o,i,t);break;case l.types.SPHERE:this.intersectSphere(t,e,o,i,t);break;case l.types.PLANE:this.intersectPlane(t,e,o,i,t)}},t.prototype.intersectBox=function(t,e,o,i,n){return this.intersectConvex(t.convexPolyhedronRepresentation,e,o,i,n)},t.prototype.intersectPlane=function(t,e,o,i,r){var s=this.from,a=this.to,p=this._direction,h=new n(0,0,1);e.vmult(h,h);var l=new n;s.vsub(o,l);var c=l.dot(h);if(a.vsub(o,l),!(c*l.dot(h)>0||s.distanceTo(a)<c)){var u=h.dot(p);if(!(Math.abs(u)<this.precision)){var d=new n,v=new n,y=new n;s.vsub(o,d);var f=-h.dot(d)/u;p.scale(f,v),s.vadd(v,y),this.reportIntersection(h,y,r,i,-1)}}},t.prototype.getAABB=function(t){var e=this.to,o=this.from;t.lowerBound.x=Math.min(e.x,o.x),t.lowerBound.y=Math.min(e.y,o.y),t.lowerBound.z=Math.min(e.z,o.z),t.upperBound.x=Math.max(e.x,o.x),t.upperBound.y=Math.max(e.y,o.y),t.upperBound.z=Math.max(e.z,o.z)},t.prototype.intersectSphere=function(t,e,o,i,n){var r=this.from,s=this.to,a=t.radius,p=Math.pow(s.x-r.x,2)+Math.pow(s.y-r.y,2)+Math.pow(s.z-r.z,2),h=2*((s.x-r.x)*(r.x-o.x)+(s.y-r.y)*(r.y-o.y)+(s.z-r.z)*(r.z-o.z)),l=Math.pow(r.x-o.x,2)+Math.pow(r.y-o.y,2)+Math.pow(r.z-o.z,2)-Math.pow(a,2),c=Math.pow(h,2)-4*p*l,u=this.Ray_intersectSphere_intersectionPoint,d=this.Ray_intersectSphere_normal;if(!(c<0))if(0===c)r.lerp(s,c,u),u.vsub(o,d),d.normalize(),this.reportIntersection(d,u,n,i,-1);else{var v=(-h-Math.sqrt(c))/(2*p),y=(-h+Math.sqrt(c))/(2*p);if(v>=0&&v<=1&&(r.lerp(s,v,u),u.vsub(o,d),d.normalize(),this.reportIntersection(d,u,n,i,-1)),this.result._shouldStop)return;y>=0&&y<=1&&(r.lerp(s,y,u),u.vsub(o,d),d.normalize(),this.reportIntersection(d,u,n,i,-1))}},t.prototype.intersectConvex=function(e,o,i,n,r,s){this.intersectConvex_minDistNormal;for(var a=this.intersectConvex_normal,p=this.intersectConvex_vector,h=(this.intersectConvex_minDistIntersect,s&&s.faceList||null),l=e.faces,c=e.vertices,u=e.faceNormals,d=this._direction,v=this.from,y=this.to,f=v.distanceTo(y),m=h?h.length:l.length,w=this.result,_=0;!w._shouldStop&&_<m;_++){var b=h?h[_]:_,x=l[b],g=u[b],B=o,A=i;p.copy(c[x[0]]),B.vmult(p,p),p.vadd(A,p),p.vsub(v,p),B.vmult(g,a);var E=d.dot(a);if(!(Math.abs(E)<this.precision)){var P=a.dot(p)/E;if(!(P<0)){d.mult(P,this.intersectPoint),this.intersectPoint.vadd(v,this.intersectPoint),this.a.copy(c[x[0]]),B.vmult(this.a,this.a),A.vadd(this.a,this.a);for(var z=1;!w._shouldStop&&z<x.length-1;z++){this.b.copy(c[x[z]]),this.c.copy(c[x[z+1]]),B.vmult(this.b,this.b),B.vmult(this.c,this.c),A.vadd(this.b,this.b),A.vadd(this.c,this.c);var C=this.intersectPoint.distanceTo(v);!t.pointInTriangle(this.intersectPoint,this.a,this.b,this.c)&&!t.pointInTriangle(this.intersectPoint,this.b,this.a,this.c)||C>f||this.reportIntersection(a,this.intersectPoint,r,n,b)}}}}},t.prototype.reportIntersection=function(e,o,i,n,r){var s=this.from,a=this.to,p=s.distanceTo(o),h=this.result;if(!(this.skipBackfaces&&e.dot(this._direction)>0))switch(h.hitFaceIndex=void 0!==r?r:-1,this.mode){case t.ALL:this.hasHit=!0,h.set(s,a,e,o,i,n,p),h.hasHit=!0,this.callback(h);break;case t.CLOSEST:(p<h.distance||!h.hasHit)&&(this.hasHit=!0,h.hasHit=!0,h.set(s,a,e,o,i,n,p));break;case t.ANY:this.hasHit=!0,h.hasHit=!0,h.set(s,a,e,o,i,n,p),h._shouldStop=!0}},t.prototype.distanceFromIntersection=function(t,e,o){o.vsub(t,this.v0);var i=this.v0.dot(e);return e.mult(i,this.intersect),this.intersect.vadd(t,this.intersect),o.distanceTo(this.intersect)},t.CLOSEST=1,t.ANY=2,t.ALL=4,t}(),z=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),C=function(t){function e(e){var o=t.call(this,e)||this;b.apply(o),o.axisList=[],o.axisIndex=0;var i=o.axisList;return o._addBodyHandler=function(t){i.push(t.body)},o._removeBodyHandler=function(t){var e=i.indexOf(t.body);-1!==e&&i.splice(e,1)},e&&o.setWorld(e),o}return z(e,t),e.prototype.setWorld=function(t){this.axisList.length=0;for(var e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},e.prototype.insertionSortX=function(t){var e,o,i;for(e=1,i=t.length;e<i;e++){var n=t[e];for(o=e-1;o>=0&&!(t[o].aabb.lowerBound.x<=n.aabb.lowerBound.x);o--)t[o+1]=t[o];t[o+1]=n}return t},e.prototype.insertionSortY=function(t){var e,o,i;for(e=1,i=t.length;e<i;e++){var n=t[e];for(o=e-1;o>=0&&!(t[o].aabb.lowerBound.y<=n.aabb.lowerBound.y);o--)t[o+1]=t[o];t[o+1]=n}return t},e.prototype.insertionSortZ=function(t){var e,o,i;for(e=1,i=t.length;e<i;e++){var n=t[e];for(o=e-1;o>=0&&!(t[o].aabb.lowerBound.z<=n.aabb.lowerBound.z);o--)t[o+1]=t[o];t[o+1]=n}return t},e.prototype.collisionPairs=function(t,e,o){var i,n,r=this.axisList,s=r.length,a=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==s;i++){var p=r[i];for(n=i+1;n<s;n++){var h=r[n];if(this.needBroadphaseCollision(p,h)){if(!this.checkBounds(p,h,a))break;this.intersectionTest(p,h,e,o)}}}},e.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,o=t.length,i=0;i!==o;i++){var n=t[i];n.aabbNeedsUpdate&&n.computeAABB()}0===e?this.insertionSortX(t):1===e?this.insertionSortY(t):2===e&&this.insertionSortZ(t)},e.prototype.checkBounds=function(t,e,o){var i,n;0===o?(i=t.position.x,n=e.position.x):1===o?(i=t.position.y,n=e.position.y):2===o&&(i=t.position.z,n=e.position.z);var r=t.boundingRadius;return n-e.boundingRadius<i+r},e.prototype.autoDetectAxis=function(){for(var t=0,e=0,o=0,i=0,n=0,r=0,s=this.axisList,a=s.length,p=1/a,h=0;h!==a;h++){var l=s[h],c=l.position.x;t+=c,e+=c*c;var u=l.position.y;o+=u,i+=u*u;var d=l.position.z;n+=d,r+=d*d}var v=e-t*t*p,y=i-o*o*p,f=r-n*n*p;this.axisIndex=v>y?v>f?0:2:y>f?1:2},e.prototype.aabbQuery=function(t,e,o){o=o||[],this.dirty&&(this.sortList(),this.dirty=!1);var i=this.axisIndex,n="x";1===i&&(n="y"),2===i&&(n="z");for(var r=this.axisList,s=(e.lowerBound[n],e.upperBound[n],0);s<r.length;s++){var a=r[s];a.aabbNeedsUpdate&&a.computeAABB(),a.aabb.overlaps(e)&&o.push(a)}return o},e}(b),S=function(){function t(e,o,i){void 0===i&&(i={}),i=Object.assign({collideConnected:!0,wakeUpBodies:!0},i),this.equations=[],this.bodyA=e,this.bodyB=o,this.id=t.idCounter++,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(e&&e.wakeUp(),o&&o.wakeUp())}return t.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},t.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},t.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},t.idCounter=0,t}(),q=function(){function t(){this.spatial=new n,this.rotational=new n}return t.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},t.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)},t}(),F=function(){function t(e,o,i,r){this.id=0,this.zero=new n,this.iMfi=new n,this.iMfj=new n,this.invIi_vmult_taui=new n,this.invIj_vmult_tauj=new n,this.tmp=new n,this.addToWlambda_temp=new n,this.addToWlambda_Gi=new n,this.addToWlambda_Gj=new n,this.addToWlambda_ri=new n,this.addToWlambda_rj=new n,this.addToWlambda_Mdiag=new n,this.id=t.EquationId++,this.minForce=i||-1e6,this.maxForce=r||1e6,this.bi=e,this.bj=o,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new q,this.jacobianElementB=new q,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}return t.prototype.setSpookParams=function(t,e,o){var i=e,n=t,r=o;this.a=4/(r*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(r*r*n*(1+4*i))},t.prototype.computeB=function(t,e,o){var i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*o},t.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.position,r=i.position;return t.spatial.dot(n)+e.spatial.dot(r)},t.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.velocity,r=i.velocity,s=o.angularVelocity,a=i.angularVelocity;return t.multiplyVectors(n,s)+e.multiplyVectors(r,a)},t.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.vlambda,r=i.vlambda,s=o.wlambda,a=i.wlambda;return t.multiplyVectors(n,s)+e.multiplyVectors(r,a)},t.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.force,r=o.torque,s=i.force,a=i.torque,p=o.invMassSolve,h=i.invMassSolve;return n.scale(p,this.iMfi),s.scale(h,this.iMfj),o.invInertiaWorldSolve.vmult(r,this.invIi_vmult_taui),i.invInertiaWorldSolve.vmult(a,this.invIj_vmult_tauj),t.multiplyVectors(this.iMfi,this.invIi_vmult_taui)+e.multiplyVectors(this.iMfj,this.invIj_vmult_tauj)},t.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,o=this.bi,i=this.bj,n=o.invMassSolve,r=i.invMassSolve,s=o.invInertiaWorldSolve,a=i.invInertiaWorldSolve,p=n+r;return s.vmult(t.rotational,this.tmp),p+=this.tmp.dot(t.rotational),a.vmult(e.rotational,this.tmp),p+this.tmp.dot(e.rotational)},t.prototype.addToWlambda=function(t){var e=this.jacobianElementA,o=this.jacobianElementB,i=this.bi,n=this.bj,r=this.addToWlambda_temp;i.vlambda.addScaledVector(i.invMassSolve*t,e.spatial,i.vlambda),n.vlambda.addScaledVector(n.invMassSolve*t,o.spatial,n.vlambda),i.invInertiaWorldSolve.vmult(e.rotational,r),i.wlambda.addScaledVector(t,r,i.wlambda),n.invInertiaWorldSolve.vmult(o.rotational,r),n.wlambda.addScaledVector(t,r,n.wlambda)},t.prototype.computeC=function(){return this.computeGiMGt()+this.eps},t.EquationId=0,t}(),M=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),j=function(t){function e(e,o,i){void 0===i&&(i=1e6);var r=t.call(this,e,o,0,i)||this;return r.ContactEquation_computeB_temp1=new n,r.ContactEquation_computeB_temp2=new n,r.ContactEquation_computeB_temp3=new n,r.ContactEquation_getImpactVelocityAlongNormal_vi=new n,r.ContactEquation_getImpactVelocityAlongNormal_vj=new n,r.ContactEquation_getImpactVelocityAlongNormal_xi=new n,r.ContactEquation_getImpactVelocityAlongNormal_xj=new n,r.ContactEquation_getImpactVelocityAlongNormal_relVel=new n,r.restitution=0,r.ri=new n,r.rj=new n,r.ni=new n,r}return M(e,t),e.prototype.computeB=function(t){var e=this.a,o=this.b,i=this.bi,n=this.bj,r=this.ri,s=this.rj,a=this.ContactEquation_computeB_temp1,p=this.ContactEquation_computeB_temp2,h=i.velocity,l=i.angularVelocity,c=(i.force,i.torque,n.velocity),u=n.angularVelocity,d=(n.force,n.torque,this.ContactEquation_computeB_temp3),v=this.jacobianElementA,y=this.jacobianElementB,f=this.ni;r.cross(f,a),s.cross(f,p),f.negate(v.spatial),a.negate(v.rotational),y.spatial.copy(f),y.rotational.copy(p),d.copy(n.position),d.vadd(s,d),d.vsub(i.position,d),d.vsub(r,d);var m=f.dot(d),w=this.restitution+1;return-m*e-(w*c.dot(f)-w*h.dot(f)+u.dot(p)-l.dot(a))*o-t*this.computeGiMf()},e.prototype.getImpactVelocityAlongNormal=function(){var t=this.ContactEquation_getImpactVelocityAlongNormal_vi,e=this.ContactEquation_getImpactVelocityAlongNormal_vj,o=this.ContactEquation_getImpactVelocityAlongNormal_xi,i=this.ContactEquation_getImpactVelocityAlongNormal_xj,n=this.ContactEquation_getImpactVelocityAlongNormal_relVel;return this.bi.position.vadd(this.ri,o),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(o,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,n),this.ni.dot(n)},e}(F),N=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),O=function(t){function e(e,o,i,n){void 0===n&&(n=1e6);var r=t.call(this,e,o)||this;void 0==i&&(i=e.position.distanceTo(o.position)),r.distance=i;var s=r.distanceEquation=new j(e,o);return r.equations.push(s),s.minForce=-n,s.maxForce=n,r}return N(e,t),e.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.distanceEquation,i=.5*this.distance,n=o.ni;e.position.vsub(t.position,n),n.normalize(),n.mult(i,o.ri),n.mult(-i,o.rj)},e}(S),I=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),T=function(t){function e(e,o,i,r,s){void 0===s&&(s=1e6);var a=t.call(this,e,i)||this;a.pivotA=o?o.clone():new n,a.pivotB=r?r.clone():new n;var p=a.equationX=new j(e,i),h=a.equationY=new j(e,i),l=a.equationZ=new j(e,i);return a.equations.push(p,h,l),p.minForce=h.minForce=l.minForce=-s,p.maxForce=h.maxForce=l.maxForce=s,p.ni.set(1,0,0),h.ni.set(0,1,0),l.ni.set(0,0,1),a}return I(e,t),e.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.equationX,i=this.equationY,n=this.equationZ;t.quaternion.vmult(this.pivotA,o.ri),e.quaternion.vmult(this.pivotB,o.rj),i.ri.copy(o.ri),i.rj.copy(o.rj),n.ri.copy(o.ri),n.rj.copy(o.rj)},e}(S),R=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),L=function(t){function e(e,o,i){void 0===i&&(i={});var r=t.call(this,e,o,-(i.maxForce?i.maxForce:1e6),i.maxForce?i.maxForce:1e6)||this;return r.tmpVec1=new n,r.tmpVec2=new n,r.axisA=i.axisA?i.axisA.clone():new n(1,0,0),r.axisB=i.axisB?i.axisB.clone():new n(0,1,0),r.maxAngle=Math.PI/2,r}return R(e,t),e.prototype.computeB=function(t){var e=this.a,o=this.b,i=this.axisA,n=this.axisB,r=this.tmpVec1,s=this.tmpVec2,a=this.jacobianElementA,p=this.jacobianElementB;return i.cross(n,r),n.cross(i,s),a.rotational.copy(s),p.rotational.copy(r),-(Math.cos(this.maxAngle)-i.dot(n))*e-this.computeGW()*o-t*this.computeGiMf()},e}(F),W=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),V=function(t){function e(e,o,i){void 0===i&&(i={});var s=t.call(this,e,new n,o,new n,i.maxForce?i.maxForce:1e6)||this;s.LockConstraint_update_tmpVec1=new n,s.LockConstraint_update_tmpVec2=new n;var a=new n;e.position.vadd(o.position,a),a.scale(.5,a),o.pointToLocalFrame(a,s.pivotB),e.pointToLocalFrame(a,s.pivotA),s.xA=e.vectorToLocalFrame(r.UNIT_X),s.xB=o.vectorToLocalFrame(r.UNIT_X),s.yA=e.vectorToLocalFrame(r.UNIT_Y),s.yB=o.vectorToLocalFrame(r.UNIT_Y),s.zA=e.vectorToLocalFrame(r.UNIT_Z),s.zB=o.vectorToLocalFrame(r.UNIT_Z);var p=s.rotationalEquation1=new L(e,o,i),h=s.rotationalEquation2=new L(e,o,i),l=s.rotationalEquation3=new L(e,o,i);return s.equations.push(p,h,l),s}return W(e,t),e.prototype.update=function(){var e=this.bodyA,o=this.bodyB,i=this.rotationalEquation1,n=this.rotationalEquation2,r=this.rotationalEquation3;this.LockConstraint_update_tmpVec1,this.LockConstraint_update_tmpVec2,t.prototype.update.call(this),e.vectorToWorldFrame(this.xA,i.axisA),o.vectorToWorldFrame(this.yB,i.axisB),e.vectorToWorldFrame(this.yA,n.axisA),o.vectorToWorldFrame(this.zB,n.axisB),e.vectorToWorldFrame(this.zA,r.axisA),o.vectorToWorldFrame(this.xB,r.axisB)},e}(T),k=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),U=function(t){function e(e,o,i){void 0===i&&(i=1e6);var r=t.call(this,e,o,i)||this;return r.axisA=new n,r.axisB=new n,r.targetVelocity=0,r.maxForce=i,r.minForce=-i,r}return k(e,t),e.prototype.computeB=function(t){this.a;var e=this.b,o=this.axisA,i=this.axisB,n=this.jacobianElementA,r=this.jacobianElementB;return n.rotational.copy(o),i.negate(r.rotational),-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()},e}(F),G=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),H=function(t){function e(e,o,i){void 0===i&&(i={});var r=t.call(this,e,i.pivotA?i.pivotA.clone():new n,o,i.pivotB?i.pivotB.clone():new n,i.maxForce||1e6)||this;r.HingeConstraint_update_tmpVec1=new n,r.HingeConstraint_update_tmpVec2=new n;var s=i.maxForce||1e6;return r.axisA=i.axisA?i.axisA.clone():new n(1,0,0),r.axisA.normalize(),r.axisB=i.axisB?i.axisB.clone():new n(1,0,0),r.axisB.normalize(),r.rotationalEquation1=new L(e,o,i),r.rotationalEquation2=new L(e,o,i),r.motorEquation=new U(e,o,s),r.motorEquation.enabled=!1,r.equations.push(r.rotationalEquation1,r.rotationalEquation2,r.motorEquation),r}return G(e,t),e.prototype.enableMotor=function(){this.motorEquation.enabled=!0},e.prototype.disableMotor=function(){this.motorEquation.enabled=!1},e.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},e.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t},e.prototype.update=function(){var e=this.bodyA,o=this.bodyB,i=this.motorEquation,n=this.rotationalEquation1,r=this.rotationalEquation2,s=this.HingeConstraint_update_tmpVec1,a=this.HingeConstraint_update_tmpVec2,p=this.axisA,h=this.axisB;t.prototype.update.call(this),e.quaternion.vmult(p,s),o.quaternion.vmult(h,a),s.tangents(n.axisA,r.axisA),n.axisB.copy(a),r.axisB.copy(a),this.motorEquation.enabled&&(e.quaternion.vmult(this.axisA,i.axisA),o.quaternion.vmult(this.axisB,i.axisB))},e}(T),X=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),D=function(t){function e(e,o,i){var r=t.call(this,e,o,i)||this;return r.FrictionEquation_computeB_temp1=new n,r.FrictionEquation_computeB_temp2=new n,r.ri=new n,r.rj=new n,r.t=new n,r}return X(e,t),e.prototype.computeB=function(t){this.a;var e=this.b,o=(this.bi,this.bj,this.ri),i=this.rj,n=this.FrictionEquation_computeB_temp1,r=this.FrictionEquation_computeB_temp2,s=this.t;o.cross(s,n),i.cross(s,r);var a=this.jacobianElementA,p=this.jacobianElementB;return s.negate(a.spatial),n.negate(a.rotational),p.spatial.copy(s),p.rotational.copy(r),-this.computeGW()*e-t*this.computeGiMf()},e}(j),Y=function(){function t(e,o,i){void 0===i&&(i={}),i=Object.assign({friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3},i),this.id=t.idCounter++,this.materials=[e,o],this.friction=i.friction,this.restitution=i.restitution,this.contactEquationStiffness=i.contactEquationStiffness,this.contactEquationRelaxation=i.contactEquationRelaxation,this.frictionEquationStiffness=i.frictionEquationStiffness,this.frictionEquationRelaxation=i.frictionEquationRelaxation}return t.idCounter=0,t}(),Z=function(){function t(e){void 0===e&&(e={}),e=Object.assign({name:"",friction:-1,restitution:-1},e),this.name=e.name,this.id=t.idCounter++,this.friction=e.friction,this.restitution=e.restitution}return t.idCounter=0,t}(),Q=function(){function t(t,e,o){void 0===o&&(o={}),this.applyForce_r=new n,this.applyForce_r_unit=new n,this.applyForce_u=new n,this.applyForce_f=new n,this.applyForce_worldAnchorA=new n,this.applyForce_worldAnchorB=new n,this.applyForce_ri=new n,this.applyForce_rj=new n,this.applyForce_ri_x_f=new n,this.applyForce_rj_x_f=new n,this.applyForce_tmp=new n,o=o||{},this.restLength=void 0!=o.restLength?o.restLength:1,this.stiffness=o.stiffness||100,this.damping=o.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new n,this.localAnchorB=new n,o.localAnchorA&&this.localAnchorA.copy(o.localAnchorA),o.localAnchorB&&this.localAnchorB.copy(o.localAnchorB),o.worldAnchorA&&this.setWorldAnchorA(o.worldAnchorA),o.worldAnchorB&&this.setWorldAnchorB(o.worldAnchorB)}return t.prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},t.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},t.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},t.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)},t.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restLength,i=this.bodyA,n=this.bodyB,r=this.applyForce_r,s=this.applyForce_r_unit,a=this.applyForce_u,p=this.applyForce_f,h=this.applyForce_tmp,l=this.applyForce_worldAnchorA,c=this.applyForce_worldAnchorB,u=this.applyForce_ri,d=this.applyForce_rj,v=this.applyForce_ri_x_f,y=this.applyForce_rj_x_f;this.getWorldAnchorA(l),this.getWorldAnchorB(c),l.vsub(i.position,u),c.vsub(n.position,d),c.vsub(l,r);var f=r.norm();s.copy(r),s.normalize(),n.velocity.vsub(i.velocity,a),n.angularVelocity.cross(d,h),a.vadd(h,a),i.angularVelocity.cross(u,h),a.vsub(h,a),s.mult(-t*(f-o)-e*a.dot(s),p),i.force.vsub(p,i.force),n.force.vadd(p,n.force),u.cross(p,v),d.cross(p,y),i.torque.vsub(v,i.torque),n.torque.vadd(y,n.torque)},t}(),K=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),J=function(t){function e(e,o,i,r){var s=r,a=[],p=[],h=[],l=[],c=[],u=Math.cos,d=Math.sin;a.push(new n(o*u(0),o*d(0),.5*-i)),l.push(0),a.push(new n(e*u(0),e*d(0),.5*i)),c.push(1);for(var v=0;v<s;v++){var y=2*Math.PI/s*(v+1),f=2*Math.PI/s*(v+.5);v<s-1?(a.push(new n(o*u(y),o*d(y),.5*-i)),l.push(2*v+2),a.push(new n(e*u(y),e*d(y),.5*i)),c.push(2*v+3),h.push([2*v+2,2*v+3,2*v+1,2*v])):h.push([0,1,2*v+1,2*v]),(s%2==1||v<s/2)&&p.push(new n(u(f),d(f),0))}h.push(c),p.push(new n(0,0,1));var m=[];for(v=0;v<l.length;v++)m.push(l[l.length-v-1]);return h.push(m),t.call(this,a,h,p)||this}return K(e,t),e}(v),$=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),tt=function(t){function e(){return t.call(this,{type:l.types.PARTICLE})||this}return $(e,t),e.prototype.calculateLocalInertia=function(t,e){return(e=e||new n).set(0,0,0),e},e.prototype.volume=function(){return 0},e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},e.prototype.calculateWorldAABB=function(t,e,o,i){o.copy(t),i.copy(t)},e}(l),et=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),ot=function(t){function e(){var e=t.call(this,{type:l.types.PLANE})||this;return e.tempNormal=new n,e.worldNormal=new n,e.worldNormalNeedsUpdate=!0,e.boundingSphereRadius=Number.MAX_VALUE,e}return et(e,t),e.prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},e.prototype.calculateLocalInertia=function(t,e){return e||new n},e.prototype.volume=function(){return Number.MAX_VALUE},e.prototype.calculateWorldAABB=function(t,e,o,i){this.tempNormal.set(0,0,1),e.vmult(this.tempNormal,this.tempNormal);var n=Number.MAX_VALUE;o.set(-n,-n,-n),i.set(n,n,n),1===this.tempNormal.x&&(i.x=t.x),1===this.tempNormal.y&&(i.y=t.y),1===this.tempNormal.z&&(i.z=t.z),-1===this.tempNormal.x&&(o.x=t.x),-1===this.tempNormal.y&&(o.y=t.y),-1===this.tempNormal.z&&(o.z=t.z)},e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE},e}(l),it=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),nt=function(t){function e(e){var o=t.call(this,{type:l.types.SPHERE})||this;if(o.radius=void 0!==e?e:1,o.radius<0)throw new Error("The sphere radius cannot be negative.");return o.updateBoundingSphereRadius(),o}return it(e,t),e.prototype.calculateLocalInertia=function(t,e){e=e||new n;var o=2*t*this.radius*this.radius/5;return e.x=o,e.y=o,e.z=o,e},e.prototype.volume=function(){return 4*Math.PI*this.radius/3},e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},e.prototype.calculateWorldAABB=function(t,e,o,i){var n=this.radius;o.x=t.x-n,i.x=t.x+n,o.y=t.y-n,i.y=t.y+n,o.z=t.z-n,i.z=t.z+n},e}(l),rt=function(){function t(){this.equations=[]}return t.prototype.solve=function(t,e){return 0},t.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},t.prototype.removeEquation=function(t){var e=this.equations,o=e.indexOf(t);-1!==o&&e.splice(o,1)},t.prototype.removeAllEquations=function(){this.equations.length=0},t}(),st=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),at=function(t){function e(){var e=t.call(this)||this;return e.GSSolver_solve_lambda=[],e.GSSolver_solve_invCs=[],e.GSSolver_solve_Bs=[],e.iterations=10,e.tolerance=1e-7,e}return st(e,t),e.prototype.solve=function(t,e){var o,i,n,r,s,a=this.iterations,p=this.tolerance*this.tolerance,h=this.equations,l=h.length,c=e.bodies,u=c.length,d=t,v=0;if(0!==l)for(var y=0;y!==u;y++)c[y].updateSolveMassProperties();var f=this.GSSolver_solve_invCs,m=this.GSSolver_solve_Bs,w=this.GSSolver_solve_lambda;f.length=l,m.length=l,w.length=l;for(var _=0;_!==l;_++){var b=h[_];w[_]=0,m[_]=b.computeB(d),f[_]=1/b.computeC()}if(0!==l){for(_=0;_!==u;_++){var x=(A=c[_]).vlambda,g=A.wlambda;x.set(0,0,0),g.set(0,0,0)}for(v=0;v!==a;v++){r=0;for(var B=0;B!==l;B++)b=h[B],o=m[B],i=f[B],(s=w[B])+(n=i*(o-b.computeGWlambda()-b.eps*s))<b.minForce?n=b.minForce-s:s+n>b.maxForce&&(n=b.maxForce-s),w[B]+=n,r+=n>0?n:-n,b.addToWlambda(n);if(r*r<p)break}for(_=0;_!==u;_++){var A,E=(A=c[_]).velocity,P=A.angularVelocity;A.vlambda.vmul(A.linearFactor,A.vlambda),E.vadd(A.vlambda,E),A.wlambda.vmul(A.angularFactor,A.wlambda),P.vadd(A.wlambda,P)}for(var z=h.length,C=1/d;z--;)h[z].multiplier=w[z]*C}return v},e}(rt),pt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),ht=function(){},lt=function(t){function e(e){var o=t.call(this)||this;for(o.SplitSolver_solve_nodes=[],o.SplitSolver_solve_nodePool=[],o.SplitSolver_solve_eqs=[],o.SplitSolver_solve_dummyWorld={bodies:[]},o.iterations=10,o.tolerance=1e-7,o.subsolver=e,o.nodes=[],o.nodePool=[];o.nodePool.length<128;)o.nodePool.push(o.createNode());return o}return pt(e,t),e.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},e.prototype.solve=function(t,e){for(var o=this.SplitSolver_solve_nodes,i=this.nodePool,n=e.bodies,r=this.equations,s=r.length,a=n.length,p=this.subsolver;i.length<a;)i.push(this.createNode());o.length=a;for(var h=0;h<a;h++)o[h]=i[h];for(h=0;h!==a;h++){var l=o[h];l.body=n[h],l.children.length=0,l.eqs.length=0,l.visited=!1}for(var c=0;c!==s;c++){var u=r[c],d=n.indexOf(u.bi),v=n.indexOf(u.bj),y=o[d],f=o[v];y.children.push(f),y.eqs.push(u),f.children.push(y),f.eqs.push(u)}var m,w=0,_=this.SplitSolver_solve_eqs;p.tolerance=this.tolerance,p.iterations=this.iterations;for(var b=this.SplitSolver_solve_dummyWorld;m=ct(o);){_.length=0,b.bodies.length=0,dt(m,vt,b.bodies,_);var x=_.length;for(_=_.sort(yt),h=0;h!==x;h++)p.addEquation(_[h]);p.solve(t,b),p.removeAllEquations(),w++}return w},e.STATIC=_.STATIC,e}(rt);function ct(t){for(var e=t.length,o=0;o!==e;o++){var i=t[o];if(!(i.visited||i.body.type&lt.STATIC))return i}}var ut=[];function dt(t,e,o,i){for(ut.push(t),t.visited=!0,e(t,o,i);ut.length;)for(var n=ut.pop(),r=void 0;r=ct(n.children);)r.visited=!0,e(r,o,i),ut.push(r)}function vt(t,e,o){e.push(t.body);for(var i=t.eqs.length,n=0;n!==i;n++){var r=t.eqs[n];-1===o.indexOf(r)&&o.push(r)}}function yt(t,e){return e.id-t.id}var ft=function(){function t(){this.objects=[],this.type=Object}return t.prototype.release=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=t.length,i=0;i!==o;i++)this.objects.push(t[i]);return this},t.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},t.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")},t.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this},t}(),mt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),wt=function(t){function e(){var e=t.call(this)||this;return e.type=n,e}return mt(e,t),e.prototype.constructObject=function(){return new n},e}(ft),_t=function(){function t(t){this.averageNormal=new n,this.averageContactPointA=new n,this.averageContactPointB=new n,this.tmpVec1=new n,this.tmpVec2=new n,this.tmpQuat1=new h,this.tmpQuat2=new h,this.point_on_plane_to_sphere=new n,this.plane_to_sphere_ortho=new n,this.pointInPolygon_edge=new n,this.pointInPolygon_edge_x_normal=new n,this.pointInPolygon_vtp=new n,this.box_to_sphere=new n,this.sphereBox_ns=new n,this.sphereBox_ns1=new n,this.sphereBox_ns2=new n,this.sphereBox_sides=[new n,new n,new n,new n,new n,new n],this.sphereBox_sphere_to_corner=new n,this.sphereBox_side_ns=new n,this.sphereBox_side_ns1=new n,this.sphereBox_side_ns2=new n,this.convex_to_sphere=new n,this.sphereConvex_edge=new n,this.sphereConvex_edgeUnit=new n,this.sphereConvex_sphereToCorner=new n,this.sphereConvex_worldCorner=new n,this.sphereConvex_worldNormal=new n,this.sphereConvex_worldPoint=new n,this.sphereConvex_worldSpherePointClosestToPlane=new n,this.sphereConvex_penetrationVec=new n,this.sphereConvex_sphereToWorldPoint=new n,this.planeBox_normal=new n,this.plane_to_corner=new n,this.planeConvex_v=new n,this.planeConvex_normal=new n,this.planeConvex_relpos=new n,this.planeConvex_projected=new n,this.convexConvex_sepAxis=new n,this.convexConvex_q=new n,this.particlePlane_normal=new n,this.particlePlane_relpos=new n,this.particlePlane_projected=new n,this.particleSphere_normal=new n,this.cqj=new h,this.convexParticle_local=new n,this.convexParticle_normal=new n,this.convexParticle_penetratedFaceNormal=new n,this.convexParticle_vertexToParticle=new n,this.convexParticle_worldPenetrationVec=new n,this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new wt,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}return t.prototype.createContactEquation=function(t,e,o,i,n,r){var s;this.contactPointPool.length?((s=this.contactPointPool.pop()).bi=t,s.bj=e):s=new j(t,e),s.enabled=t.collisionResponse&&e.collisionResponse&&o.collisionResponse&&i.collisionResponse;var a=this.currentContactMaterial;s.restitution=a.restitution,s.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);var p=o.material||t.material,h=i.material||e.material;return p&&h&&p.restitution>=0&&h.restitution>=0&&(s.restitution=p.restitution*h.restitution),s.si=n||o,s.sj=r||i,s},t.prototype.createFrictionEquationsFromContact=function(t,e){var o=t.bi,i=t.bj,n=t.si,r=t.sj,s=this.world,a=this.currentContactMaterial,p=a.friction,h=n.material||o.material,l=r.material||i.material;if(h&&l&&h.friction>=0&&l.friction>=0&&(p=h.friction*l.friction),p>0){var c=p*s.gravity.length(),u=o.invMass+i.invMass;u>0&&(u=1/u);var d=this.frictionEquationPool,v=d.length?d.pop():new D(o,i,c*u),y=d.length?d.pop():new D(o,i,c*u);return v.bi=y.bi=o,v.bj=y.bj=i,v.minForce=y.minForce=-c*u,v.maxForce=y.maxForce=c*u,v.ri.copy(t.ri),v.rj.copy(t.rj),y.ri.copy(t.ri),y.rj.copy(t.rj),t.ni.tangents(v.t,y.t),v.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),y.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),v.enabled=y.enabled=t.enabled,e.push(v,y),!0}return!1},t.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var o=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];this.averageNormal.setZero(),this.averageContactPointA.setZero(),this.averageContactPointB.setZero();for(var n=e.bi,r=(e.bj,0);r!==t;r++)(e=this.result[this.result.length-1-r]).bodyA!==n?(this.averageNormal.vadd(e.ni,this.averageNormal),this.averageContactPointA.vadd(e.ri,this.averageContactPointA),this.averageContactPointB.vadd(e.rj,this.averageContactPointB)):(this.averageNormal.vsub(e.ni,this.averageNormal),this.averageContactPointA.vadd(e.rj,this.averageContactPointA),this.averageContactPointB.vadd(e.ri,this.averageContactPointB));var s=1/t;this.averageContactPointA.scale(s,o.ri),this.averageContactPointB.scale(s,o.rj),i.ri.copy(o.ri),i.rj.copy(o.rj),this.averageNormal.normalize(),this.averageNormal.tangents(o.t,i.t)}},t.prototype.getContacts=function(t,e,o,i,n,r,s){this.contactPointPool=n,this.frictionEquationPool=s,this.result=i,this.frictionResult=r;for(var a=this.tmpQuat1,p=this.tmpQuat2,h=this.tmpVec1,c=this.tmpVec2,u=0,d=t.length;u!==d;u++){var v=t[u],y=e[u],f=null;v.material&&y.material&&(f=o.getContactMaterial(v.material,y.material)||null);for(var m=!!(v.type&_.KINEMATIC&&y.type&_.STATIC||v.type&_.STATIC&&y.type&_.KINEMATIC||v.type&_.KINEMATIC&&y.type&_.KINEMATIC),w=0;w<v.shapes.length;w++){v.quaternion.mult(v.shapeOrientations[w],a),v.quaternion.vmult(v.shapeOffsets[w],h),h.vadd(v.position,h);for(var b=v.shapes[w],x=0;x<y.shapes.length;x++){y.quaternion.mult(y.shapeOrientations[x],p),y.quaternion.vmult(y.shapeOffsets[x],c),c.vadd(y.position,c);var g=y.shapes[x];if(b.collisionFilterMask&g.collisionFilterGroup&&g.collisionFilterMask&b.collisionFilterGroup&&!(h.distanceTo(c)>b.boundingSphereRadius+g.boundingSphereRadius)){var B=null;b.material&&g.material&&(B=o.getContactMaterial(b.material,g.material)||null),this.currentContactMaterial=B||f||o.defaultContactMaterial;var A=b.type<g.type,E=!1;switch(b.type|g.type){case l.types.CONVEXPOLYHEDRON|l.types.CONVEXPOLYHEDRON:E=A?this.convexConvex(b,g,h,c,a,p,v,y,b,g,m):this.convexConvex(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.CONVEXPOLYHEDRON|l.types.PARTICLE:E=A?this.convexParticle(b,g,h,c,a,p,v,y,b,g,m):this.convexParticle(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.BOX|l.types.CONVEXPOLYHEDRON:E=A?this.boxConvex(b,g,h,c,a,p,v,y,b,g,m):this.boxConvex(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.SPHERE|l.types.CONVEXPOLYHEDRON:E=A?this.sphereConvex(b,g,h,c,a,p,v,y,b,g,m):this.sphereConvex(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.BOX|l.types.BOX:E=A?this.boxBox(b,g,h,c,a,p,v,y,b,g,m):this.boxBox(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.BOX|l.types.PARTICLE:E=A?this.boxParticle(b,g,h,c,a,p,v,y,b,g,m):this.boxParticle(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.SPHERE|l.types.BOX:E=A?this.sphereBox(b,g,h,c,a,p,v,y,b,g,m):this.sphereBox(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.SPHERE|l.types.SPHERE:E=A?this.sphereSphere(b,g,h,c,a,p,v,y,b,g,m):this.sphereSphere(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.SPHERE|l.types.PLANE:E=A?this.spherePlane(b,g,h,c,a,p,v,y,b,g,m):this.spherePlane(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.SPHERE|l.types.PARTICLE:E=A?this.sphereParticle(b,g,h,c,a,p,v,y,b,g,m):this.sphereParticle(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.PLANE|l.types.BOX:E=A?this.planeBox(b,g,h,c,a,p,v,y,b,g,m):this.planeBox(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.PLANE|l.types.CONVEXPOLYHEDRON:E=A?this.planeConvex(b,g,h,c,a,p,v,y,b,g,m):this.planeConvex(g,b,c,h,p,a,y,v,g,b,m);break;case l.types.PLANE|l.types.PARTICLE:E=A?this.planeParticle(b,g,h,c,a,p,v,y,b,g,m):this.planeParticle(g,b,c,h,p,a,y,v,g,b,m)}E&&m&&(o.shapeOverlapKeeper.set(b.id,g.id),o.bodyOverlapKeeper.set(v.id,y.id))}}}}},t.prototype.boxBox=function(t,e,o,i,n,r,s,a,p,h,l){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,o,i,n,r,s,a,t,e,l)},t.prototype.boxConvex=function(t,e,o,i,n,r,s,a,p,h,l){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,o,i,n,r,s,a,t,e,l)},t.prototype.boxParticle=function(t,e,o,i,n,r,s,a,p,h,l){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,o,i,n,r,s,a,t,e,l)},t.prototype.sphereSphere=function(t,e,o,i,n,r,s,a,p,h,l){var c=t,u=e;if(l)return o.distanceSquared(i)<Math.pow(c.radius+u.radius,2);var d=this.createContactEquation(s,a,t,e,p,h);return i.vsub(o,d.ni),d.ni.normalize(),d.ri.copy(d.ni),d.rj.copy(d.ni),d.ri.mult(c.radius,d.ri),d.rj.mult(-u.radius,d.rj),d.ri.vadd(o,d.ri),d.ri.vsub(s.position,d.ri),d.rj.vadd(i,d.rj),d.rj.vsub(a.position,d.rj),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult),!1},t.prototype.spherePlane=function(t,e,o,i,n,r,s,a,p,h,l){var c=this.createContactEquation(s,a,t,e,p,h);c.ni.set(0,0,1),r.vmult(c.ni,c.ni),c.ni.negate(c.ni),c.ni.normalize();var u=t;if(c.ni.mult(u.radius,c.ri),o.vsub(i,this.point_on_plane_to_sphere),c.ni.mult(c.ni.dot(this.point_on_plane_to_sphere),this.plane_to_sphere_ortho),this.point_on_plane_to_sphere.vsub(this.plane_to_sphere_ortho,c.rj),-this.point_on_plane_to_sphere.dot(c.ni)<=u.radius){if(l)return!0;var d=c.ri,v=c.rj;d.vadd(o,d),d.vsub(s.position,d),v.vadd(i,v),v.vsub(a.position,v),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}return!1},t.prototype.pointInPolygon=function(t,e,o){for(var i=null,n=t.length,r=0;r!==n;r++){var s=t[r],a=this.pointInPolygon_edge;t[(r+1)%n].vsub(s,a);var p=this.pointInPolygon_edge_x_normal;a.cross(e,p);var h=this.pointInPolygon_vtp;o.vsub(s,h);var l=p.dot(h);if(!(null===i||l>0&&!0===i||l<=0&&!1===i))return!1;null===i&&(i=l>0)}return!0},t.prototype.sphereBox=function(t,e,o,i,n,r,s,a,p,h,l){var c=this.v3pool,u=t,d=e,v=this.sphereBox_sides;o.vsub(i,this.box_to_sphere),d.getSideNormals(v,r);for(var y=u.radius,f=!1,m=this.sphereBox_side_ns,w=this.sphereBox_side_ns1,_=this.sphereBox_side_ns2,b=null,x=0,g=0,B=0,A=null,E=0,P=v.length;E!==P&&!1===f;E++){var z=this.sphereBox_ns;z.copy(v[E]);var C=z.norm();z.normalize();var S=this.box_to_sphere.dot(z);if(S<C+y&&S>0){var q=this.sphereBox_ns1,F=this.sphereBox_ns2;q.copy(v[(E+1)%3]),F.copy(v[(E+2)%3]);var M=q.norm(),j=F.norm();q.normalize(),F.normalize();var N=this.box_to_sphere.dot(q),O=this.box_to_sphere.dot(F);if(N<M&&N>-M&&O<j&&O>-j){var I=Math.abs(S-C-y);if((null===A||I<A)&&(A=I,g=N,B=O,b=C,m.copy(z),w.copy(q),_.copy(F),x++,l))return!0}}}if(x){f=!0;var T=this.createContactEquation(s,a,t,e,p,h);m.mult(-y,T.ri),T.ni.copy(m),T.ni.negate(T.ni),m.mult(b,m),w.mult(g,w),m.vadd(w,m),_.mult(B,_),m.vadd(_,T.rj),T.ri.vadd(o,T.ri),T.ri.vsub(s.position,T.ri),T.rj.vadd(i,T.rj),T.rj.vsub(a.position,T.rj),this.result.push(T),this.createFrictionEquationsFromContact(T,this.frictionResult)}for(var R=c.get(),L=this.sphereBox_sphere_to_corner,W=0;2!==W&&!f;W++)for(var V=0;2!==V&&!f;V++)for(var k=0;2!==k&&!f;k++)if(R.set(0,0,0),W?R.vadd(v[0],R):R.vsub(v[0],R),V?R.vadd(v[1],R):R.vsub(v[1],R),k?R.vadd(v[2],R):R.vsub(v[2],R),i.vadd(R,L),L.vsub(o,L),L.norm2()<y*y){if(l)return!0;f=!0,(T=this.createContactEquation(s,a,t,e,p,h)).ri.copy(L),T.ri.normalize(),T.ni.copy(T.ri),T.ri.mult(y,T.ri),T.rj.copy(R),T.ri.vadd(o,T.ri),T.ri.vsub(s.position,T.ri),T.rj.vadd(i,T.rj),T.rj.vsub(a.position,T.rj),this.result.push(T),this.createFrictionEquationsFromContact(T,this.frictionResult)}c.release(R),R=null;var U=c.get(),G=c.get(),H=c.get(),X=c.get(),D=c.get(),Y=v.length;for(W=0;W!==Y&&!f;W++)for(V=0;V!==Y&&!f;V++)if(W%3!=V%3){v[V].cross(v[W],U),U.normalize(),v[W].vadd(v[V],G),H.copy(o),H.vsub(G,H),H.vsub(i,H);var Z=H.dot(U);for(U.mult(Z,X),k=0;k===W%3||k===V%3;)k++;D.copy(o),D.vsub(X,D),D.vsub(G,D),D.vsub(i,D);var Q=Math.abs(Z),K=D.norm();if(Q<v[k].norm()&&K<y){if(l)return!0;f=!0;var J=this.createContactEquation(s,a,t,e,p,h);G.vadd(X,J.rj),J.rj.copy(J.rj),D.negate(J.ni),J.ni.normalize(),J.ri.copy(J.rj),J.ri.vadd(i,J.ri),J.ri.vsub(o,J.ri),J.ri.normalize(),J.ri.mult(y,J.ri),J.ri.vadd(o,J.ri),J.ri.vsub(s.position,J.ri),J.rj.vadd(i,J.rj),J.rj.vsub(a.position,J.rj),this.result.push(J),this.createFrictionEquationsFromContact(J,this.frictionResult)}}return c.release(U,G,H,X,D),!1},t.prototype.sphereConvex=function(t,e,o,i,n,r,s,a,p,h,l){var c=this.v3pool,u=t,d=e;o.vsub(i,this.convex_to_sphere);for(var v=d.faceNormals,y=d.faces,f=d.vertices,m=u.radius,w=0;w!==f.length;w++){var _=f[w],b=this.sphereConvex_worldCorner;r.vmult(_,b),i.vadd(b,b);var x=this.sphereConvex_sphereToCorner;if(b.vsub(o,x),x.norm2()<m*m)return!!l||((I=this.createContactEquation(s,a,t,e,p,h)).ri.copy(x),I.ri.normalize(),I.ni.copy(I.ri),I.ri.mult(m,I.ri),b.vsub(i,I.rj),I.ri.vadd(o,I.ri),I.ri.vsub(s.position,I.ri),I.rj.vadd(i,I.rj),I.rj.vsub(a.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult),!1)}for(var g=!1,B=(w=0,y.length);w!==B&&!1===g;w++){var A=v[w],E=y[w],P=this.sphereConvex_worldNormal;r.vmult(A,P);var z=this.sphereConvex_worldPoint;r.vmult(f[E[0]],z),z.vadd(i,z);var C=this.sphereConvex_worldSpherePointClosestToPlane;P.mult(-m,C),o.vadd(C,C);var S=this.sphereConvex_penetrationVec;C.vsub(z,S);var q=S.dot(P),F=this.sphereConvex_sphereToWorldPoint;if(o.vsub(z,F),q<0&&F.dot(P)>0){for(var M=[],j=0,N=E.length;j!==N;j++){var O=c.get();r.vmult(f[E[j]],O),i.vadd(O,O),M.push(O)}if(this.pointInPolygon(M,P,o)){if(l)return!0;g=!0;var I=this.createContactEquation(s,a,t,e,p,h);P.mult(-m,I.ri),P.negate(I.ni);var T=c.get();P.mult(-q,T);var R=c.get();P.mult(-m,R),o.vsub(i,I.rj),I.rj.vadd(R,I.rj),I.rj.vadd(T,I.rj),I.rj.vadd(i,I.rj),I.rj.vsub(a.position,I.rj),I.ri.vadd(o,I.ri),I.ri.vsub(s.position,I.ri),c.release(T),c.release(R),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult),j=0;for(var L=M.length;j!==L;j++)c.release(M[j]);return!1}for(j=0;j!==E.length;j++){var W=c.get(),V=c.get();r.vmult(f[E[(j+1)%E.length]],W),r.vmult(f[E[(j+2)%E.length]],V),i.vadd(W,W),i.vadd(V,V);var k=this.sphereConvex_edge;V.vsub(W,k);var U=this.sphereConvex_edgeUnit;k.unit(U);var G=c.get(),H=c.get();o.vsub(W,H);var X=H.dot(U);U.mult(X,G),G.vadd(W,G);var D=c.get();if(G.vsub(o,D),X>0&&X*X<k.norm2()&&D.norm2()<m*m){if(l)return!0;I=this.createContactEquation(s,a,t,e,p,h),G.vsub(i,I.rj),G.vsub(o,I.ni),I.ni.normalize(),I.ni.mult(m,I.ri),I.rj.vadd(i,I.rj),I.rj.vsub(a.position,I.rj),I.ri.vadd(o,I.ri),I.ri.vsub(s.position,I.ri),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult);var Y=0;for(L=M.length;Y!==L;Y++)c.release(M[Y]);return c.release(W),c.release(V),c.release(G),c.release(D),c.release(H),!1}c.release(W),c.release(V),c.release(G),c.release(D),c.release(H)}for(j=0,L=M.length;j!==L;j++)c.release(M[j])}}return!1},t.prototype.planeBox=function(t,e,o,i,n,r,s,a,p,h,l){var c=e;return c.convexPolyhedronRepresentation.material=e.material,c.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,c.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,c.convexPolyhedronRepresentation,o,i,n,r,s,a,t,e,l)},t.prototype.planeConvex=function(t,e,o,i,n,r,s,a,p,h,l){var c=t,u=e,d=o,v=i,y=n,f=r,m=s,w=a,_=this.planeConvex_v,b=this.planeConvex_normal;b.set(0,0,1),y.vmult(b,b);for(var x=0,g=this.planeConvex_relpos,B=0;B!==u.vertices.length;B++)if(_.copy(u.vertices[B]),f.vmult(_,_),v.vadd(_,_),_.vsub(d,g),b.dot(g)<=0){if(l)return!0;var A=this.createContactEquation(m,w,c,u,p,h),E=this.planeConvex_projected;b.mult(b.dot(g),E),_.vsub(E,E),E.vsub(d,A.ri),A.ni.copy(b),_.vsub(v,A.rj),A.ri.vadd(d,A.ri),A.ri.vsub(m.position,A.ri),A.rj.vadd(v,A.rj),A.rj.vsub(w.position,A.rj),this.result.push(A),x++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(A,this.frictionResult)}return this.enableFrictionReduction&&x&&this.createFrictionFromAverage(x),!1},t.prototype.convexConvex=function(t,e,o,i,n,r,s,a,p,h,l,c,u){var d=this.convexConvex_sepAxis;if(o.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)return!1;var v=t;if(v.findSeparatingAxis(v,o,n,i,r,d,c,u)){var y=[],f=this.convexConvex_q;v.clipAgainstHull(o,n,v,i,r,d,-100,100,y);for(var m=0,w=0;w!==y.length;w++){if(l)return!0;var _=this.createContactEquation(s,a,t,e,p,h),b=_.ri,x=_.rj;d.negate(_.ni),y[w].normal.negate(f),f.mult(y[w].depth,f),y[w].point.vadd(f,b),x.copy(y[w].point),b.vsub(o,b),x.vsub(i,x),b.vadd(o,b),b.vsub(s.position,b),x.vadd(i,x),x.vsub(a.position,x),this.result.push(_),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(_,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}return!1},t.prototype.planeParticle=function(t,e,o,i,n,r,s,a,p,h,l){var c=this.particlePlane_normal;c.set(0,0,1),a.quaternion.vmult(c,c);var u=this.particlePlane_relpos;if(o.vsub(a.position,u),c.dot(u)<=0){if(l)return!0;var d=this.createContactEquation(s,a,t,e,p,h);d.ni.copy(c),d.ni.negate(d.ni),d.ri.set(0,0,0);var v=this.particlePlane_projected;c.mult(c.dot(o),v),o.vsub(v,v),d.rj.copy(v),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}return!1},t.prototype.sphereParticle=function(t,e,o,i,n,r,s,a,p,h,l){var c=e,u=this.particleSphere_normal;if(u.set(0,0,1),o.vsub(i,u),u.norm2()<=c.radius*c.radius){if(l)return!0;var d=this.createContactEquation(s,a,t,e,p,h);u.normalize(),d.rj.copy(u),d.rj.mult(c.radius,d.rj),d.ni.copy(u),d.ni.negate(d.ni),d.ri.set(0,0,0),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}return!1},t.prototype.convexParticle=function(t,e,o,i,n,r,s,a,p,h,l){var c=-1,u=this.convexParticle_penetratedFaceNormal,d=this.convexParticle_worldPenetrationVec,v=null,y=e,f=this.convexParticle_local;if(f.copy(o),f.vsub(i,f),r.conjugate(this.cqj),this.cqj.vmult(f,f),y.pointIsInside(f)){y.worldVerticesNeedsUpdate&&y.computeWorldVertices(i,r),y.worldFaceNormalsNeedsUpdate&&y.computeWorldFaceNormals(r);for(var m=0,w=y.faces.length;m!==w;m++){var _=[y.worldVertices[y.faces[m][0]]],b=y.worldFaceNormals[m];o.vsub(_[0],this.convexParticle_vertexToParticle);var x=-b.dot(this.convexParticle_vertexToParticle);if(null===v||Math.abs(x)<Math.abs(v)){if(l)return!0;v=x,c=m,u.copy(b)}}if(-1!==c){var g=this.createContactEquation(s,a,t,e,p,h);u.mult(v,d),d.vadd(o,d),d.vsub(i,d),g.rj.copy(d),u.negate(g.ni),g.ri.set(0,0,0);var B=g.ri,A=g.rj;B.vadd(o,B),B.vsub(s.position,B),A.vadd(i,A),A.vsub(a.position,A),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}return!1},t}(),bt=function(){function t(){this.data={keys:[]}}return t.prototype.get=function(t,e){if(t>e){var o=e;e=t,t=o}return this.data[t+"-"+e]},t.prototype.set=function(t,e,o){if(t>e){var i=e;e=t,t=i}var n=t+"-"+e;this.get(t,e)||this.data.keys.push(n),this.data[n]=o},t.prototype.reset=function(){for(var t=this.data,e=t.keys;e.length>0;)delete t[e.pop()]},t}(),xt=function(){function t(){this.current=[],this.previous=[]}return t.prototype.getKey=function(t,e){if(e<t){var o=e;e=t,t=o}return t<<16|e},t.prototype.set=function(t,e){for(var o=this.getKey(t,e),i=this.current,n=0;o>i[n];)n++;if(o!==i[n]){for(var r=i.length-1;r>=n;r--)i[r+1]=i[r];i[n]=o}},t.prototype.tick=function(){var t=this.current;this.current=this.previous,this.previous=t,this.current.length=0},t.prototype.getDiff=function(t,e){for(var o=this.current,i=this.previous,n=o.length,r=i.length,s=0,a=0;a<n;a++){for(var p=o[a];p>i[s];)s++;p===i[s]||gt(t,p)}for(s=0,a=0;a<r;a++){for(var h=i[a];h>o[s];)s++;o[s]===h||gt(e,h)}},t}();function gt(t,e){t.push((4294901760&e)>>16,65535&e)}var Bt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),At=function(){},Et=function(){},Pt=function(){},zt=function(t){function e(e){var o=t.call(this)||this;return o.tmpAABB1=new s,o.tmpArray1=[],o.tmpRay=new P,o.removeBody=function(t){return o.remove(t)},o.World_step_postStepEvent={type:"postStep"},o.World_step_preStepEvent={type:"preStep"},o.World_step_collideEvent={type:_.COLLIDE_EVENT_NAME,body:null,contact:null},o.World_step_oldContacts=[],o.World_step_frictionEquationPool=[],o.World_step_p1=[],o.World_step_p2=[],o.World_step_gvec=new n,o.World_step_vi=new n,o.World_step_vj=new n,o.World_step_wi=new n,o.World_step_wj=new n,o.World_step_t1=new n,o.World_step_t2=new n,o.World_step_rixn=new n,o.World_step_rjxn=new n,o.World_step_step_q=new h,o.World_step_step_w=new h,o.World_step_step_wq=new h,o.invI_tau_dt=new n,o.emitContactEvents=function(){var t=[],e=[],i={type:"beginContact",bodyA:null,bodyB:null},n={type:"endContact",bodyA:null,bodyB:null},r={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},s={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};return function(){var a=o.hasAnyEventListener("beginContact"),p=o.hasAnyEventListener("endContact");if((a||p)&&o.bodyOverlapKeeper.getDiff(t,e),a)for(var h=0,l=t.length;h<l;h+=2)i.bodyA=o.getBodyById(t[h]),i.bodyB=o.getBodyById(t[h+1]),i.bodyA&&i.bodyB&&o.dispatchEvent(i),i.bodyA=i.bodyB=void 0;if(p)for(h=0,l=e.length;h<l;h+=2)n.bodyA=o.getBodyById(e[h]),n.bodyB=o.getBodyById(e[h+1]),n.bodyA&&n.bodyB&&o.dispatchEvent(n),n.bodyA=n.bodyB=void 0;t.length=e.length=0;var c=o.hasAnyEventListener("beginShapeContact"),u=o.hasAnyEventListener("endShapeContact");if((c||u)&&o.shapeOverlapKeeper.getDiff(t,e),c)for(h=0,l=t.length;h<l;h+=2){var d=o.getShapeById(t[h]),v=o.getShapeById(t[h+1]);r.shapeA=d,r.shapeB=v,r.bodyA=d.body,r.bodyB=v.body,o.dispatchEvent(r),r.shapeA=r.shapeB=void 0,r.bodyA=r.bodyB=void 0}if(u)for(h=0,l=e.length;h<l;h+=2)d=o.getShapeById(e[h]),v=o.getShapeById(e[h+1]),s.shapeA=d,s.shapeB=v,s.bodyA=d.body,s.bodyB=v.body,o.dispatchEvent(s),s.shapeA=s.shapeB=void 0,s.bodyA=s.bodyB=void 0}},e=e||{},o.dt=-1,o.allowSleep=!!e.allowSleep,o.contacts=[],o.frictionEquations=[],o.quatNormalizeSkip=void 0!==e.quatNormalizeSkip?e.quatNormalizeSkip:0,o.quatNormalizeFast=void 0!==e.quatNormalizeFast&&e.quatNormalizeFast,o.time=0,o.stepnumber=0,o.default_dt=1/60,o.nextId=0,o.gravity=new n,e.gravity&&o.gravity.copy(e.gravity),o.broadphase=void 0!==e.broadphase?e.broadphase:new A,o.bodies=[],o.solver=void 0!==e.solver?e.solver:new at,o.constraints=[],o.narrowphase=new _t(o),o.collisionMatrix=new a,o.collisionMatrixPrevious=new a,o.bodyOverlapKeeper=new xt,o.shapeOverlapKeeper=new xt,o.materials=[],o.contactmaterials=[],o.contactMaterialTable=new bt,o.defaultMaterial=new Z("default"),o.defaultContactMaterial=new Y(o.defaultMaterial,o.defaultMaterial,{friction:1,restitution:0}),o.doProfiling=!1,o.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},o.accumulator=0,o.subsystems=[],o.addBodyEvent={type:"addBody",body:null},o.removeBodyEvent={type:"removeBody",body:null},o.idToBodyMap={},o.broadphase.setWorld(o),o}return Bt(e,t),e.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},e.prototype.numObjects=function(){return this.bodies.length},e.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()},e.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof _&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))},e.prototype.addConstraint=function(t){this.constraints.push(t)},e.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},e.prototype.rayTest=function(t,e,o){o instanceof E?this.raycastClosest(t,e,{skipBackfaces:!0},o):this.raycastAll(t,e,{skipBackfaces:!0},o)},e.prototype.raycastAll=function(t,e,o,i){return o.mode=P.ALL,o.from=t,o.to=e,o.callback=i,this.tmpRay.intersectWorld(this,o)},e.prototype.raycastAny=function(t,e,o,i){return o.mode=P.ANY,o.from=t,o.to=e,o.result=i,this.tmpRay.intersectWorld(this,o)},e.prototype.raycastClosest=function(t,e,o,i){return o.mode=P.CLOSEST,o.from=t,o.to=e,o.result=i,this.tmpRay.intersectWorld(this,o)},e.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,o=this.bodies,i=o.indexOf(t);if(-1!==i){o.splice(i,1);for(var n=0;n!==o.length;n++)o[n].index=n;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}},e.prototype.getBodyById=function(t){return this.idToBodyMap[t]},e.prototype.getShapeById=function(t){for(var e=this.bodies,o=0,i=e.length;o<i;o++)for(var n=e[o].shapes,r=0,s=n.length;r<s;r++){var a=n[r];if(a.id===t)return a}},e.prototype.addMaterial=function(t){this.materials.push(t)},e.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},e.prototype.step=function(t,e,o){if(o=o||10,-1===(e=e||-1))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var i=0;this.accumulator>=t&&i<o;)this.internalStep(t),this.accumulator-=t,i++;this.accumulator%=t;for(var n=this.accumulator/t,r=this.bodies.length,s=0;s!==r;s++){var a=this.bodies[s];a.previousPosition.lerp(a.position,n,a.interpolatedPosition),a.previousQuaternion.slerp(a.quaternion,n,a.interpolatedQuaternion),a.previousQuaternion.normalize()}this.time+=e}},e.prototype.internalStep=function(t){this.dt=t;var e,o,i=this.contacts,n=this.World_step_p1,r=this.World_step_p2,s=this.numObjects(),a=this.bodies,p=this.solver,h=this.gravity,l=this.doProfiling,c=this.profile,u=_.DYNAMIC,d=this.constraints,v=this.World_step_frictionEquationPool,y=(h.norm(),h.x),f=h.y,m=h.z,w=0;for(l&&(e=performance.now()),w=0;w!==s;w++)if((S=a[w]).type===u){var b=S.force,x=S.mass;b.x+=x*y,b.y+=x*f,b.z+=x*m}for(w=0,o=this.subsystems.length;w!==o;w++)this.subsystems[w].update();l&&(e=performance.now()),n.length=0,r.length=0,this.broadphase.collisionPairs(this,n,r),l&&(c.broadphase=performance.now()-e);var g=d.length;for(w=0;w!==g;w++)if(!(N=d[w]).collideConnected)for(var B=n.length-1;B>=0;B-=1)(N.bodyA===n[B]&&N.bodyB===r[B]||N.bodyB===n[B]&&N.bodyA===r[B])&&(n.splice(B,1),r.splice(B,1));this.collisionMatrixTick(),l&&(e=performance.now());var A=this.World_step_oldContacts,E=i.length;for(w=0;w!==E;w++)A.push(i[w]);i.length=0;var P=this.frictionEquations.length;for(w=0;w!==P;w++)v.push(this.frictionEquations[w]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(n,r,this,i,A,this.frictionEquations,v),l&&(c.narrowphase=performance.now()-e),l&&(e=performance.now()),w=0;w<this.frictionEquations.length;w++)p.addEquation(this.frictionEquations[w]);for(var z=i.length,C=0;C!==z;C++){var S=(N=i[C]).bi,q=N.bj,F=N.si,M=N.sj;(S.material&&q.material&&this.getContactMaterial(S.material,q.material)||this.defaultContactMaterial).friction,S.material&&q.material&&(S.material.friction>=0&&q.material.friction>=0&&(S.material.friction,q.material.friction),S.material.restitution>=0&&q.material.restitution>=0&&(N.restitution=S.material.restitution*q.material.restitution)),p.addEquation(N),S.allowSleep&&S.type===_.DYNAMIC&&S.sleepState===_.SLEEPING&&q.sleepState===_.AWAKE&&q.type!==_.STATIC&&q.velocity.norm2()+q.angularVelocity.norm2()>=2*Math.pow(q.sleepSpeedLimit,2)&&(S._wakeUpAfterNarrowphase=!0),q.allowSleep&&q.type===_.DYNAMIC&&q.sleepState===_.SLEEPING&&S.sleepState===_.AWAKE&&S.type!==_.STATIC&&S.velocity.norm2()+S.angularVelocity.norm2()>=2*Math.pow(S.sleepSpeedLimit,2)&&(q._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(S,q,!0),this.collisionMatrixPrevious.get(S,q)||(this.World_step_collideEvent.body=q,this.World_step_collideEvent.contact=N,S.dispatchEvent(this.World_step_collideEvent),this.World_step_collideEvent.body=S,q.dispatchEvent(this.World_step_collideEvent)),this.bodyOverlapKeeper.set(S.id,q.id),this.shapeOverlapKeeper.set(F.id,M.id)}for(this.emitContactEvents(),l&&(c.makeContactConstraints=performance.now()-e,e=performance.now()),w=0;w!==s;w++)(S=a[w])._wakeUpAfterNarrowphase&&(S.wakeUp(),S._wakeUpAfterNarrowphase=!1);var j=d.length;for(w=0;w!==j;w++){var N;(N=d[w]).update(),B=0;for(var O=N.equations.length;B!==O;B++){var I=N.equations[B];p.addEquation(I)}}p.solve(t,this),l&&(c.solve=performance.now()-e),p.removeAllEquations();var T=Math.pow;for(w=0;w!==s;w++)if((S=a[w]).type&u){var R=T(1-S.linearDamping,t),L=S.velocity;L.mult(R,L);var W=S.angularVelocity;if(W){var V=T(1-S.angularDamping,t);W.mult(V,W)}}for(this.dispatchEvent(this.World_step_preStepEvent),w=0;w!==s;w++)(S=a[w]).preStep&&S.preStep.call(S);l&&(e=performance.now());var k=this.stepnumber%(this.quatNormalizeSkip+1)==0,U=this.quatNormalizeFast;for(w=0;w!==s;w++)a[w].integrate(t,k,U);for(this.clearForces(),this.broadphase.dirty=!0,l&&(c.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(this.World_step_postStepEvent),w=0;w!==s;w++){var G=(S=a[w]).postStep;G&&G.call(S)}if(this.allowSleep)for(w=0;w!==s;w++)a[w].sleepTick(this.time)},e.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,o=0;o!==e;o++){var i=t[o];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}},e}(p);o.d(e,"AABB",function(){return s}),o.d(e,"ArrayCollisionMatrix",function(){return a}),o.d(e,"Broadphase",function(){return b}),o.d(e,"GridBroadphase",function(){return g}),o.d(e,"NaiveBroadphase",function(){return A}),o.d(e,"Ray",function(){return P}),o.d(e,"RaycastResult",function(){return E}),o.d(e,"SAPBroadphase",function(){return C}),o.d(e,"Constraint",function(){return S}),o.d(e,"DistanceConstraint",function(){return O}),o.d(e,"LockConstraint",function(){return V}),o.d(e,"PointToPointConstraint",function(){return T}),o.d(e,"HingeConstraint",function(){return H}),o.d(e,"ContactEquation",function(){return j}),o.d(e,"Equation",function(){return F}),o.d(e,"FrictionEquation",function(){return D}),o.d(e,"RotationalEquation",function(){return L}),o.d(e,"RotationalMotorEquation",function(){return U}),o.d(e,"ContactMaterial",function(){return Y}),o.d(e,"Material",function(){return Z}),o.d(e,"Quaternion",function(){return h}),o.d(e,"Mat3",function(){return i}),o.d(e,"Transform",function(){return c}),o.d(e,"Vec3",function(){return n}),o.d(e,"Vec3Consts",function(){return r}),o.d(e,"JacobianElement",function(){return q}),o.d(e,"BodyOptions",function(){return w}),o.d(e,"Body",function(){return _}),o.d(e,"Spring",function(){return Q}),o.d(e,"Box",function(){return f}),o.d(e,"HullResult",function(){return d}),o.d(e,"ConvexPolyhedron",function(){return v}),o.d(e,"Cylinder",function(){return J}),o.d(e,"Particle",function(){return tt}),o.d(e,"Plane",function(){return ot}),o.d(e,"Shape",function(){return l}),o.d(e,"Sphere",function(){return nt}),o.d(e,"GSSolver",function(){return at}),o.d(e,"Solver",function(){return rt}),o.d(e,"SplitNode",function(){return ht}),o.d(e,"SplitSolver",function(){return lt}),o.d(e,"Pool",function(){return ft}),o.d(e,"EventTarget",function(){return p}),o.d(e,"Vec3Pool",function(){return wt}),o.d(e,"Narrowphase",function(){return _t}),o.d(e,"ContactEvent",function(){return At}),o.d(e,"ShapeContactEvent",function(){return Et}),o.d(e,"CollideEvent",function(){return Pt}),o.d(e,"World",function(){return zt})}])});